import{j as e,L as t}from"./index-B1hR7bBa.js";import{r as s}from"./leaflet-vendor-CuwtxqHJ.js";import{a}from"./Dashboard-DFxPjqoY.js";import{a as n}from"./api-BEIyjD6w.js";import"./react-vendor-DFJYf2oa.js";var i=Object.defineProperty,r=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,o=(e,t,s)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,u=(e,t,s)=>new Promise((a,n)=>{var i=e=>{try{l(s.next(e))}catch(t){n(t)}},r=e=>{try{l(s.throw(e))}catch(t){n(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);l((s=s.apply(e,t)).next())});const m=new class{createAgent(e){return u(this,null,function*(){return a.post(n.ai.agents,e)})}queryAgent(e,t){return u(this,null,function*(){const s=n.ai.query.replace("{agent_id}",e);return a.post(s,t)})}getAgentStatus(e){return u(this,null,function*(){const t=n.ai.status.replace("{agent_id}",e);return a.get(t)})}getSystemStatus(){return u(this,null,function*(){return a.get(n.ai.systemStatus)})}searchMemory(e){return u(this,null,function*(){return a.post(n.ai.memorySearch,e)})}optimizeMemory(e){return u(this,arguments,function*(e,t={}){return a.post(n.ai.memoryOptimize,((e,t)=>{for(var s in t||(t={}))l.call(t,s)&&o(e,s,t[s]);if(r)for(var s of r(t))c.call(t,s)&&o(e,s,t[s]);return e})({agent_id:e},t))})}getMemoryPerformance(e){return u(this,null,function*(){const t=n.ai.memoryPerformance.replace("{agent_id}",e);return a.get(t)})}backupMemory(e){return u(this,null,function*(){const t=n.ai.memoryBackup.replace("{agent_id}",e);return a.post(t,{})})}getAvailableRoles(){return u(this,null,function*(){return a.get(n.ai.roles)})}checkHealth(){return u(this,null,function*(){return a.get(n.ai.health)})}createResearchAssistant(e,t=10){return u(this,null,function*(){return this.createAgent({agent_id:e,role:"research_assistant",cost_budget_monthly:t,temperature:.1,model:"gpt-4o-mini"})})}createCitationSpecialist(e,t=5){return u(this,null,function*(){return this.createAgent({agent_id:e,role:"citation_specialist",cost_budget_monthly:t,temperature:.05,model:"gpt-4o-mini"})})}askResearchQuestion(e,t,s){return u(this,null,function*(){return this.queryAgent(e,{query:t,context:s,include_memory:!0})})}};var d=(e,t,s)=>new Promise((a,n)=>{var i=e=>{try{l(s.next(e))}catch(t){n(t)}},r=e=>{try{l(s.throw(e))}catch(t){n(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);l((s=s.apply(e,t)).next())});const h=new class{analyzeDocument(e){return d(this,null,function*(){return a.post(n.aiAnalysis.analyze,e)})}summarizeDocument(e){return d(this,null,function*(){return a.post(n.aiAnalysis.summarize,e)})}extractMetadata(e){return d(this,null,function*(){return a.post(n.aiAnalysis.extractMetadata,e)})}analyzeContent(e){return d(this,null,function*(){return a.post(n.aiAnalysis.analyzeContent,e)})}discoverRelationships(e){return d(this,null,function*(){return a.post(n.aiAnalysis.discoverRelationships,e)})}generateCitation(e){return d(this,null,function*(){return a.post(n.aiAnalysis.generateCitation,e)})}generateCitationsBatch(e){return d(this,null,function*(){return a.post(n.aiAnalysis.batchCitations,e)})}getCitationStyles(){return d(this,null,function*(){return a.get(n.aiAnalysis.citationStyles)})}getAnalysisStatistics(){return d(this,null,function*(){return a.get(n.aiAnalysis.analysisStatistics)})}getCitationStatistics(){return d(this,null,function*(){return a.get(n.aiAnalysis.citationStatistics)})}checkHealth(){return d(this,null,function*(){return a.get(n.aiAnalysis.health)})}generateABNTCitation(e,t){return d(this,null,function*(){return this.generateCitation({document_data:e,citation_style:"abnt",include_url:!0,include_access_date:!0,academic_level:"graduate",research_context:t})})}generateAPACitation(e,t){return d(this,null,function*(){return this.generateCitation({document_data:e,citation_style:"apa",include_url:!0,include_access_date:!0,academic_level:"graduate",research_context:t})})}quickAnalysis(e){return d(this,null,function*(){const[t,s,a]=yield Promise.all([this.summarizeDocument(e),this.extractMetadata(e),this.generateABNTCitation(e)]);return{summary:t,metadata:s,citation:a}})}generateMultiStyleCitations(e){return d(this,null,function*(){const t=["abnt","apa","chicago","vancouver"],s=t.map(t=>({document_data:e,citation_style:t,include_url:!0,include_access_date:!0,academic_level:"graduate"})),a=yield this.generateCitationsBatch({citations:s}),n={};return a.citations.forEach((e,s)=>{n[t[s]]=e}),n})}};var y=Object.defineProperty,p=Object.getOwnPropertySymbols,g=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,_=(e,t,s)=>t in e?y(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,v=(e,t)=>{for(var s in t||(t={}))g.call(t,s)&&_(e,s,t[s]);if(p)for(var s of p(t))f.call(t,s)&&_(e,s,t[s]);return e},x=(e,t,s)=>new Promise((a,n)=>{var i=e=>{try{l(s.next(e))}catch(t){n(t)}},r=e=>{try{l(s.throw(e))}catch(t){n(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,r);l((s=s.apply(e,t)).next())}),j=({selectedDocuments:a=[],onDocumentAnalyzed:n,className:i=""})=>{const[r,l]=s.useState([]),[c,o]=s.useState(""),[u,d]=s.useState(!1),[y,p]=s.useState(null),[g,f]=s.useState(!1),[_,j]=s.useState(null),[A,b]=s.useState([]),N=s.useRef(null),C="research_assistant_main";s.useEffect(()=>{w(),k()},[]),s.useEffect(()=>{S()},[r]);const S=()=>{var e;null==(e=N.current)||e.scrollIntoView({behavior:"smooth"})},w=()=>x(null,null,function*(){try{d(!0);try{const e=yield m.getAgentStatus(C);p(e),f(!0),P("AI Research Assistant connected successfully!")}catch(e){yield m.createResearchAssistant(C,15);const t=yield m.getAgentStatus(C);p(t),f(!0),P("New AI Research Assistant created and ready to help with Brazilian legislative research!")}}catch(t){const e=t instanceof Error?t.message:"Failed to initialize AI agent";j(e),P(`Error: ${e}`,"error")}finally{d(!1)}}),k=()=>x(null,null,function*(){try{const[e,t]=yield Promise.all([m.checkHealth(),h.checkHealth()]),s=[];e.ai_agents_available&&s.push("AI Conversation"),t.ai_document_analysis_available&&s.push("Document Analysis","Citation Generation"),b(s)}catch(e){console.warn("Could not check service health:",e)}}),P=(e,t="info")=>{const s={id:Date.now().toString(),type:"system",content:e,timestamp:new Date};l(e=>[...e,s])},z=()=>x(null,null,function*(){if(!c.trim()||!g||u)return;const e=c.trim();o(""),(e=>{const t={id:Date.now().toString(),type:"user",content:e,timestamp:new Date};l(e=>[...e,t])})(e),d(!0),j(null);try{const s={};a.length>0&&(s.selected_documents=a.map(e=>({urn:e.urn,title:e.title,type:e.tipo_documento,authority:e.autoridade})),s.document_count=a.length);const i=yield m.askResearchQuestion(C,e,s),r=e.toLowerCase().includes("analis")||e.toLowerCase().includes("resumo")||e.toLowerCase().includes("citaÃ§Ã£o")||e.toLowerCase().includes("citation");let c={};if(r&&a.length>0)try{const t=a.slice(0,3).map(t=>x(null,null,function*(){const[s,a]=yield Promise.all([h.summarizeDocument(t),h.generateABNTCitation(t,e)]);return{summary:s,citation:a}})),s=yield Promise.all(t);c.summaries=s.map(e=>e.summary),c.citations=s.map(e=>e.citation),n&&s.forEach(e=>n(e))}catch(t){console.warn("Document analysis failed:",t)}((e,t)=>{const s={id:Date.now().toString(),type:"assistant",content:e.response,timestamp:new Date,metadata:v({cost_cents:e.cost_cents,from_cache:e.from_cache,processing_time_ms:e.response_time_ms},t)};l(e=>[...e,s])})(i,c);const o=yield m.getAgentStatus(C);p(o)}catch(s){const e=s instanceof Error?s.message:"Failed to send message";j(e),P(`Error: ${e}`,"error")}finally{d(!1)}});return e.jsxs("div",{className:`ai-research-assistant ${i}`,children:[e.jsxs("div",{className:"assistant-header",children:[e.jsxs("div",{className:"header-info",children:[e.jsx("h3",{children:"ðŸ¤– AI Research Assistant"}),y&&e.jsxs("div",{className:"agent-status",children:[e.jsx("span",{className:`status-indicator ${y.status}`}),e.jsxs("small",{children:["Cost: ",(y.cost_summary.monthly_cost_cents/100).toFixed(2),"Â¢ | Memory: ",y.memory_stats.short_term_entries+y.memory_stats.long_term_entries," entries"]})]})]}),A.length>0&&e.jsx("div",{className:"available-features",children:e.jsxs("small",{children:["Available: ",A.join(", ")]})})]}),e.jsxs("div",{className:"messages-container",children:[r.map(t=>{var s,a;return e.jsxs("div",{className:`message ${t.type}`,children:[e.jsxs("div",{className:"message-content",children:[e.jsx("div",{className:"content-text",children:t.content}),t.metadata&&e.jsxs("div",{className:"message-metadata",children:[void 0!==t.metadata.cost_cents&&e.jsxs("span",{className:"cost",children:["Cost: ",t.metadata.cost_cents.toFixed(4),"Â¢"]}),t.metadata.from_cache&&e.jsx("span",{className:"cache-hit",children:"Cached"}),t.metadata.processing_time_ms&&e.jsxs("span",{className:"processing-time",children:[t.metadata.processing_time_ms.toFixed(0),"ms"]})]}),(null==(s=t.metadata)?void 0:s.citations)&&e.jsxs("div",{className:"citations-section",children:[e.jsx("h4",{children:"Generated Citations:"}),t.metadata.citations.map((t,s)=>e.jsxs("div",{className:"citation-item",children:[e.jsx("div",{className:"citation-text",children:t.citation_text}),e.jsxs("div",{className:"citation-metadata",children:["Style: ",t.citation_style.toUpperCase()," | Quality: ",(100*t.quality_score).toFixed(0),"%"]})]},s))]}),(null==(a=t.metadata)?void 0:a.summaries)&&e.jsxs("div",{className:"summaries-section",children:[e.jsx("h4",{children:"Document Summaries:"}),t.metadata.summaries.map((t,s)=>e.jsxs("div",{className:"summary-item",children:[e.jsx("h5",{children:t.title}),e.jsx("p",{children:t.summary_text}),t.key_points.length>0&&e.jsx("ul",{className:"key-points",children:t.key_points.map((t,s)=>e.jsx("li",{children:t},s))})]},s))]})]}),e.jsx("div",{className:"message-timestamp",children:t.timestamp.toLocaleTimeString()})]},t.id)}),u&&e.jsxs("div",{className:"message assistant loading",children:[e.jsx(t,{size:"small"}),e.jsx("span",{children:"AI Research Assistant is thinking..."})]}),e.jsx("div",{ref:N})]}),0===r.length&&0===a.length&&e.jsxs("div",{className:"suggested-questions",children:[e.jsx("h4",{children:"Try asking:"}),["Analise os documentos selecionados e identifique os principais temas de transporte.","Gere citaÃ§Ãµes ABNT para os documentos selecionados.","Quais sÃ£o as tendÃªncias regulatÃ³rias no transporte brasileiro?","Compare a legislaÃ§Ã£o federal e estadual de transporte.","Identifique oportunidades de pesquisa nos documentos."].map((t,s)=>e.jsx("button",{className:"suggested-question",onClick:()=>(e=>{o(e)})(t),disabled:u||!g,children:t},s))]}),a.length>0&&e.jsx("div",{className:"context-info",children:e.jsxs("small",{children:["ðŸ“„ ",a.length," document",1!==a.length?"s":""," selected for analysis"]})}),e.jsxs("div",{className:"input-container",children:[e.jsx("textarea",{value:c,onChange:e=>o(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),z())},placeholder:g?"Ask me about Brazilian legislative research, document analysis, or citations...":"Initializing AI Research Assistant...",disabled:u||!g,rows:3,className:"message-input"}),e.jsx("button",{onClick:z,disabled:u||!g||!c.trim(),className:"send-button",children:u?e.jsx(t,{size:"small"}):"ðŸ“¤ Send"})]}),_&&e.jsxs("div",{className:"error-message",children:[e.jsx("strong",{children:"Error:"})," ",_,e.jsx("button",{onClick:()=>j(null),className:"close-error",children:"Ã—"})]})]})};export{j as default};
