import{j as e}from"./index-DQmXZ-MY.js";import{r as t}from"./leaflet-vendor-CuwtxqHJ.js";import{b as n,A as a,C as o}from"./api-BEIyjD6w.js";import{g as r}from"./react-vendor-DFJYf2oa.js";import{r as s,h as i}from"./utils-Ck0FxTy8.js";var l=Object.defineProperty,c=Object.defineProperties,d=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,h=Object.prototype.propertyIsEnumerable,u=(e,t,n)=>t in e?l(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,g=(e,t,n)=>u(e,"symbol"!=typeof t?t+"":t,n),f=(e,t,n)=>new Promise((a,o)=>{var r=e=>{try{i(n.next(e))}catch(t){o(t)}},s=e=>{try{i(n.throw(e))}catch(t){o(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,s);i((n=n.apply(e,t)).next())});const x=new class{constructor(e){g(this,"prefix","legislativo_"),g(this,"maxAge",36e5),g(this,"maxSize",5242880),g(this,"version","1.0.0"),g(this,"stats",{hits:0,misses:0,itemCount:0,totalSize:0}),(null==e?void 0:e.prefix)&&(this.prefix=e.prefix),(null==e?void 0:e.maxAge)&&(this.maxAge=e.maxAge),(null==e?void 0:e.maxSize)&&(this.maxSize=e.maxSize),(null==e?void 0:e.version)&&(this.version=e.version),this.updateStats(),this.cleanup()}set(e,t,n=this.maxAge){try{const a={value:t,expires:Date.now()+n,version:this.version,size:this.estimateSize(t)},o=JSON.stringify(a),r=this.prefix+e;return o.length>this.maxSize?(console.warn(`Cache item too large: ${e}`),!1):(this.getTotalSize()+o.length>this.maxSize&&this.evictOldest(o.length),localStorage.setItem(r,o),this.updateStats(),!0)}catch(a){if(a instanceof Error&&"QuotaExceededError"===a.name){console.warn("LocalStorage quota exceeded, cleaning up..."),this.cleanup();try{const a={value:t,expires:Date.now()+n,version:this.version};return localStorage.setItem(this.prefix+e,JSON.stringify(a)),!0}catch(o){return!1}}return console.error("Cache set error:",a),!1}}get(e){try{const t=this.prefix+e,n=localStorage.getItem(t);if(!n)return this.stats.misses++,null;const a=JSON.parse(n);return a.expires<Date.now()||a.version!==this.version?(localStorage.removeItem(t),this.stats.misses++,this.updateStats(),null):(this.stats.hits++,a.value)}catch(t){return console.error("Cache get error:",t),this.stats.misses++,null}}getOrFetch(e,t){return f(this,arguments,function*(e,t,n=this.maxAge){const a=this.get(e);if(null!==a)return a;try{const a=yield t();return this.set(e,a,n),a}catch(o){const t=`stale_${e}`,n=this.get(t);if(null!==n)return console.warn("Using stale cache for:",e),n;throw o}})}remove(e){localStorage.removeItem(this.prefix+e),this.updateStats()}clear(){this.getAllKeys().forEach(e=>localStorage.removeItem(e)),this.updateStats()}cleanup(){const e=Date.now();this.getAllKeys().forEach(t=>{try{const n=localStorage.getItem(t);if(n){const a=JSON.parse(n);(a.expires<e||a.version!==this.version)&&localStorage.removeItem(t)}}catch(n){localStorage.removeItem(t)}}),this.updateStats()}getStats(){const e=this.stats.hits+this.stats.misses,t=e>0?this.stats.hits/e*100:0;return n=((e,t)=>{for(var n in t||(t={}))m.call(t,n)&&u(e,n,t[n]);if(p)for(var n of p(t))h.call(t,n)&&u(e,n,t[n]);return e})({},this.stats),c(n,d({hitRate:t}));var n}getBatch(e){return f(this,null,function*(){const t=new Map;return e.forEach(e=>{t.set(e,this.get(e))}),t})}setBatch(e){e.forEach((e,t)=>{this.set(t,e.value,e.ttl||this.maxAge)})}warm(e,t){return f(this,null,function*(){const n=e.map(e=>f(this,null,function*(){if(null===this.get(e))try{const n=yield t(e);this.set(e,n)}catch(n){console.error(`Failed to warm cache for key: ${e}`,n)}}));yield Promise.all(n)})}getAllKeys(){return Object.keys(localStorage).filter(e=>e.startsWith(this.prefix))}getTotalSize(){let e=0;return this.getAllKeys().forEach(t=>{const n=localStorage.getItem(t);n&&(e+=n.length)}),e}estimateSize(e){try{return JSON.stringify(e).length}catch(t){return 0}}evictOldest(e){const t=[];this.getAllKeys().forEach(e=>{try{const n=localStorage.getItem(e);if(n){const a=JSON.parse(n);t.push({key:e,expires:a.expires||0,size:n.length})}}catch(n){localStorage.removeItem(e)}}),t.sort((e,t)=>e.expires-t.expires);let n=0;for(const a of t){if(n>=e)break;localStorage.removeItem(a.key),n+=a.size}}updateStats(){const e=this.getAllKeys();this.stats.itemCount=e.length,this.stats.totalSize=this.getTotalSize()}}({prefix:"legislativo_",maxAge:36e5,maxSize:5242880,version:"1.0.0"}),y={generateKey:(e,t)=>`${e}_${Object.keys(t).sort().map(e=>`${e}:${t[e]}`).join("_")}`,cacheAPIResponse(e,t,n=9e5){return f(this,null,function*(){const a=y.generateKey("api",{url:e,method:(null==t?void 0:t.method)||"GET"});return x.getOrFetch(a,()=>f(null,null,function*(){const n=yield fetch(e,t);if(!n.ok)throw new Error(`API error: ${n.statusText}`);return n.json()}),n)})},clearAPICache(){Object.keys(localStorage).filter(e=>e.startsWith("legislativo_api_")).forEach(e=>localStorage.removeItem(e))}};var v=Object.defineProperty,b=Object.defineProperties,w=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable,O=(e,t,n)=>t in e?v(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,C=(e,t)=>{for(var n in t||(t={}))S.call(t,n)&&O(e,n,t[n]);if(j)for(var n of j(t))$.call(t,n)&&O(e,n,t[n]);return e},k=(e,t)=>b(e,w(t)),R=(e,t,n)=>O(e,"symbol"!=typeof t?t+"":t,n),D=(e,t,n)=>new Promise((a,o)=>{var r=e=>{try{i(n.next(e))}catch(t){o(t)}},s=e=>{try{i(n.throw(e))}catch(t){o(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,s);i((n=n.apply(e,t)).next())});const L={"/api/v1/search":{ttl:9e5,priority:"high"},"/api/v1/sources":{ttl:864e5,priority:"low"},"/api/v1/export":{ttl:18e5,priority:"medium"}},E=new class{constructor(){R(this,"abortControllers",new Map),R(this,"pendingRequests",new Map)}fetch(e){return D(this,arguments,function*(e,t={}){var r;const s=t,{ttl:i,retry:l=3,timeout:c=a.timeout,fallbackToCache:d=!0}=s,p=((e,t)=>{var n={};for(var a in e)S.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&j)for(var a of j(e))t.indexOf(a)<0&&$.call(e,a)&&(n[a]=e[a]);return n})(s,["ttl","retry","timeout","fallbackToCache"]),m=e.startsWith("http")?e:n(e),h=k(C(C({},o),p),{headers:C(C({},a.headers),p.headers)}),u=this.generateCacheKey(m,h),g=this.pendingRequests.get(u);if(g)return g;if(!h.method||"GET"===h.method){const e=x.get(u);if(null!==e)return"headers"in e&&(null==(r=e.headers)?void 0:r["X-Cache"])&&console.log(`Cache HIT: ${m}`),e}const f=new AbortController;this.abortControllers.set(u,f);const y=setTimeout(()=>{f.abort()},c),v=this.fetchWithRetry(m,k(C({},h),{signal:f.signal}),l).then(e=>D(this,null,function*(){clearTimeout(y);const t=e.headers.get("X-Cache")||"MISS";e.headers.get("X-Cache-Time"),console.log(`API ${t}: ${m}`);const n=yield e.json();if(e.ok&&(!h.method||"GET"===h.method)){const e=i||this.getTTLForURL(m);x.set(u,n,e),x.set(`stale_${u}`,n,2*e)}return n})).catch(e=>D(this,null,function*(){if(clearTimeout(y),d&&(!h.method||"GET"===h.method)){const e=x.get(u);if(null!==e)return console.warn(`Using cached data due to error: ${m}`),e;const t=x.get(`stale_${u}`);if(null!==t)return console.warn(`Using stale cache due to error: ${m}`),t}throw e})).finally(()=>{this.abortControllers.delete(u),this.pendingRequests.delete(u)});return this.pendingRequests.set(u,v),v})}fetchWithRetry(e,t,n){return D(this,null,function*(){let a=null;for(let r=0;r<=n;r++)try{const a=yield fetch(e,t);if(a.status>=500&&r<n){yield this.delay(Math.min(1e3*Math.pow(2,r),1e4));continue}return a}catch(o){if(a=o,o instanceof Error&&"AbortError"===o.name)throw o;if(r<n){yield this.delay(Math.min(1e3*Math.pow(2,r),1e4));continue}}throw a||new Error("Fetch failed")})}generateCacheKey(e,t){const n={url:e,method:t.method||"GET",body:t.body?JSON.stringify(t.body):void 0};return y.generateKey("fetch",n)}getTTLForURL(e){const t=new URL(e,window.location.origin).pathname,n=L[t];if(n)return n.ttl;for(const[a,o]of Object.entries(L))if(t.startsWith(a))return o.ttl;return 9e5}delay(e){return new Promise(t=>setTimeout(t,e))}cancel(e){const t=this.generateCacheKey(e,{}),n=this.abortControllers.get(t);n&&n.abort()}prefetch(e){return D(this,null,function*(){const t=e.map(e=>this.fetch(e,{fallbackToCache:!0}).catch(()=>{}));yield Promise.all(t)})}clearCache(e){e?Object.keys(localStorage).filter(t=>t.includes(e)).forEach(e=>localStorage.removeItem(e)):y.clearAPICache()}getCacheStats(){return x.getStats()}},P=r(s());var T=Object.defineProperty,N=Object.getOwnPropertySymbols,I=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,M=(e,t,n)=>t in e?T(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const A=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),B=(e,t,n)=>{const a=new Blob([e],{type:n}),o=URL.createObjectURL(a),r=document.createElement("a");r.href=o,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)};var z=Object.defineProperty,F=Object.defineProperties,_=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,K=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable,J=(e,t,n)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,W=(e,t,n)=>new Promise((a,o)=>{var r=e=>{try{i(n.next(e))}catch(t){o(t)}},s=e=>{try{i(n.throw(e))}catch(t){o(t)}},i=e=>e.done?a(e.value):Promise.resolve(e.value).then(r,s);i((n=n.apply(e,t)).next())});const X=(...e)=>W(null,[...e],function*(e={}){const{quality:t=.9,scale:n=2,includeControls:a=!1,includeLegend:o=!0,backgroundColor:r="#ffffff",filename:s="legislative-map"}=e;try{const e=document.querySelector(".map-wrapper");if(!e)throw new Error("Map container not found");const l=e.querySelectorAll(".map-controls"),c=[];a||l.forEach((e,t)=>{const n=e;c[t]=n.style.display,n.style.display="none"});const d=e.querySelector(".map-legend");let p="";!o&&d&&(p=d.style.display,d.style.display="none");const m={allowTaint:!0,useCORS:!0,scale:n,backgroundColor:r,width:e.offsetWidth,height:e.offsetHeight,logging:!1,removeContainer:!1,imageTimeout:15e3,onclone:e=>{const t=e.querySelector(".map-wrapper");t&&(t.style.transform="none",t.style.position="static")}},h=yield i(e,m);a||l.forEach((e,t)=>{e.style.display=c[t]||""}),!o&&d&&(d.style.display=p);const u=`${s}-${(new Date).toISOString().slice(0,19).replace(/:/g,"-")}.png`;h.toBlob(e=>{if(!e)throw new Error("Failed to create image blob");V(e,u)},"image/png",t)}catch(l){throw console.error("Map export failed:",l),new Error(`Failed to export map: ${l instanceof Error?l.message:"Unknown error"}`)}}),H=(e,t)=>{const n=document.createElement("div");n.className="map-export-overlay",n.style.cssText="\n    position: absolute;\n    top: 10px;\n    left: 10px;\n    background: rgba(255, 255, 255, 0.95);\n    padding: 16px;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n    font-size: 14px;\n    line-height: 1.4;\n    max-width: 300px;\n    z-index: 1000;\n    border: 1px solid #e0e0e0;\n  ";const a=document.createElement("h3");a.textContent="Monitor Legislativo de Transportes",a.style.cssText="\n    margin: 0 0 12px 0;\n    font-size: 16px;\n    font-weight: 600;\n    color: #2196F3;\n  ";const o=document.createElement("div"),r=(new Date).toLocaleDateString("pt-BR");return o.innerHTML=`\n    <div style="margin-bottom: 8px;"><strong>Data de exportação:</strong> ${r}</div>\n    <div style="margin-bottom: 8px;"><strong>Documentos encontrados:</strong> ${e.length}</div>\n    ${t?`<div style="margin-bottom: 8px;"><strong>Estado selecionado:</strong> ${t}</div>`:""}\n    <div style="margin-bottom: 8px;"><strong>Fonte:</strong> Dados Abertos do Governo Federal</div>\n    <div style="font-size: 12px; color: #666; margin-top: 12px; padding-top: 12px; border-top: 1px solid #e0e0e0;">\n      Plataforma Acadêmica de Pesquisa<br>\n      Legislação de Transportes do Brasil\n    </div>\n  `,n.appendChild(a),n.appendChild(o),n},V=(e,t)=>{const n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=t,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>URL.revokeObjectURL(n),100)},Y=()=>{var e;try{const t=!!document.createElement("canvas").getContext,n=!!window.Blob,a=!!(null==(e=window.URL)?void 0:e.createObjectURL);return t&&n&&a}catch(t){return!1}};var Q=Object.defineProperty,Z=Object.defineProperties,ee=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,oe=(e,t,n)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,re=(e,t)=>{for(var n in t||(t={}))ne.call(t,n)&&oe(e,n,t[n]);if(te)for(var n of te(t))ae.call(t,n)&&oe(e,n,t[n]);return e},se=(e,t)=>Z(e,ee(t)),ie=({isOpen:n,onClose:a,documents:o,id:r})=>{const[s,i]=t.useState("csv"),[l,c]=t.useState(!1),[d,p]=t.useState(!0),[m,h]=t.useState("idle"),[u,g]=t.useState({from:"",to:""}),f=t.useCallback((e,t)=>{const n={format:e,documents:o.map(e=>e.id).sort(),includeMap:t.includeMap,includeMetadata:t.includeMetadata,dateRange:t.dateRange};return y.generateKey("export",n)},[o]),v=t.useCallback((e,t)=>{const n=e instanceof Blob?e:new Blob([e],{type:"text/plain"}),a=URL.createObjectURL(n),o=document.createElement("a");o.href=a,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)},[]);return n?e.jsx("div",{id:r,className:"export-panel-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"export-panel-title",children:e.jsxs("div",{className:"export-panel",children:[e.jsxs("div",{className:"export-header",children:[e.jsx("h2",{id:"export-panel-title",children:"Exportar Dados"}),e.jsx("button",{className:"close-btn",onClick:a,"aria-label":"Fechar",children:"✕"})]}),e.jsxs("div",{className:"export-content",children:[e.jsx("div",{className:"export-summary",children:e.jsxs("p",{children:[e.jsx("strong",{children:o.length})," documentos selecionados para exportação"]})}),e.jsxs("div",{className:"export-section",children:[e.jsx("h3",{children:"Formato de Exportação"}),e.jsxs("div",{className:"format-options",children:[e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",name:"format",value:"csv",checked:"csv"===s,onChange:e=>i(e.target.value)}),e.jsxs("span",{className:"format-label",children:[e.jsx("strong",{children:"CSV"})," - Dados tabulares para análise"]})]}),e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",name:"format",value:"xml",checked:"xml"===s,onChange:e=>i(e.target.value)}),e.jsxs("span",{className:"format-label",children:[e.jsx("strong",{children:"XML"})," - Dados estruturados para sistemas"]})]}),e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",name:"format",value:"html",checked:"html"===s,onChange:e=>i(e.target.value)}),e.jsxs("span",{className:"format-label",children:[e.jsx("strong",{children:"HTML"})," - Relatório formatado para leitura"]})]}),e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",name:"format",value:"bibtex",checked:"bibtex"===s,onChange:e=>i(e.target.value)}),e.jsxs("span",{className:"format-label",children:[e.jsx("strong",{children:"BibTeX"})," - Referências bibliográficas para LaTeX"]})]}),e.jsxs("label",{className:"radio-option",children:[e.jsx("input",{type:"radio",name:"format",value:"png",checked:"png"===s,disabled:!Y(),onChange:e=>i(e.target.value)}),e.jsxs("span",{className:"format-label",children:[e.jsx("strong",{children:"PNG"})," - Imagem do mapa atual",!Y()&&e.jsx("em",{children:" (não suportado neste navegador)"})]})]})]})]}),e.jsxs("div",{className:"export-section",children:[e.jsx("h3",{children:"Opções de Exportação"}),e.jsxs("label",{className:"checkbox-option",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:e=>p(e.target.checked)}),"Incluir metadados (fonte, citação, URL)"]}),"png"!==s&&e.jsxs("label",{className:"checkbox-option",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:e=>c(e.target.checked)}),"Incluir informações geográficas"]})]}),e.jsxs("div",{className:"export-section",children:[e.jsx("h3",{children:"Filtro de Data (Opcional)"}),e.jsxs("div",{className:"date-range",children:[e.jsxs("div",{className:"date-input-group",children:[e.jsx("label",{children:"Data inicial:"}),e.jsx("input",{type:"date",value:u.from,onChange:e=>g(se(re({},u),{from:e.target.value})),"aria-label":"Data inicial"})]}),e.jsxs("div",{className:"date-input-group",children:[e.jsx("label",{children:"Data final:"}),e.jsx("input",{type:"date",value:u.to,onChange:e=>g(se(re({},u),{to:e.target.value})),"aria-label":"Data final"})]})]})]}),e.jsxs("div",{className:"export-section citation-info",children:[e.jsx("h3",{children:"Informações para Citação Acadêmica"}),e.jsx("p",{className:"citation-note",children:"Os dados exportados incluem informações completas de citação para uso acadêmico. Recomenda-se sempre verificar a fonte original dos documentos."}),e.jsxs("div",{className:"suggested-citation",children:[e.jsx("strong",{children:"Citação sugerida para esta pesquisa:"}),e.jsxs("p",{className:"citation-text",children:["Mapa Legislativo Acadêmico. Dados legislativos georeferenciados do Brasil. Exportado em ",(new Date).toLocaleDateString("pt-BR"),". Disponível em: [URL da aplicação]."]})]})]})]}),e.jsxs("div",{className:"export-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:a,children:"Cancelar"}),e.jsxs("button",{className:"export-confirm-btn",onClick:()=>{return e=function*(){const e={format:s,includeMap:l,includeMetadata:d,dateRange:u.from||u.to?u:void 0};try{const a=f(s,e);h("checking");const r=x.get(a);if(r){console.log("Using cached export");const e=`monitor-legislativo-${s}-${Date.now()}.${s}`;return v(r,e),void h("ready")}try{const e=yield(t=`/api/v1/export/cached/${encodeURIComponent(a)}`,E.fetch(t,void 0));if(e&&e.content){console.log("Using server cached export"),x.set(a,e.content,36e5);const t=`monitor-legislativo-${s}-${Date.now()}.${s}`;return v(e.content,t),void h("ready")}}catch(n){console.log("No server cache available, generating fresh export")}h("generating");let i=o;e.dateRange&&(i=o.filter(t=>!(e.dateRange.from&&t.date<e.dateRange.from||e.dateRange.to&&t.date>e.dateRange.to)));let l=null;switch(s){case"csv":l=((e,t)=>{const n=e.map(e=>((e,t)=>{for(var n in t||(t={}))I.call(t,n)&&M(e,n,t[n]);if(N)for(var n of N(t))U.call(t,n)&&M(e,n,t[n]);return e})({ID:e.id,"Título":e.title,Tipo:e.type,"Número":e.number,Data:e.date,Estado:e.state||"","Município":e.municipality||"",Resumo:e.summary,"Palavras-chave":e.keywords.join(", ")},t.includeMetadata&&{Fonte:e.source,"Citação":e.citation,URL:e.url||""})),a=P.unparse(n);B(a,`transport-legislation-data-${(new Date).toISOString()}.csv`,"text/csv")})(i,e);break;case"xml":l=((e,t)=>{const n=`  <metadata>\n    <data_exportacao>${(new Date).toISOString()}</data_exportacao>\n    <total_documentos>${e.length}</total_documentos>\n  </metadata>\n`,a=e.map(e=>{const n=e.keywords.map(e=>`      <palavra_chave>${A(e)}</palavra_chave>`).join("\n");return`  <documento>\n    <id>${e.id}</id>\n    <titulo>${A(e.title)}</titulo>\n    <tipo>${e.type}</tipo>\n    <numero>${A(e.number)}</numero>\n    <data>${e.date}</data>\n    ${e.state?`<estado>${e.state}</estado>`:""}\n    ${e.municipality?`<municipio>${A(e.municipality)}</municipio>`:""}\n    <resumo>${A(e.summary)}</resumo>\n    <palavras_chave>\n${n}\n    </palavras_chave>\n    ${t.includeMetadata?`<metadados>\n      <fonte>${A(e.source)}</fonte>\n      <citacao>${A(e.citation)}</citacao>\n      ${e.url?`<url>${A(e.url)}</url>`:""}\n    </metadados>`:""}\n  </documento>`}).join("\n");B('<?xml version="1.0" encoding="UTF-8"?>\n<documentos_legislativos>\n'+n+a+"\n</documentos_legislativos>",`transport-legislation-data-${(new Date).toISOString()}.xml`,"application/xml")})(i,e);break;case"html":l=((e,t)=>{const n=`<!DOCTYPE html>\n<html lang="pt-BR">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Relatório de Dados Legislativos</title>\n    <style>\n        body {\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            line-height: 1.6;\n            margin: 0;\n            padding: 20px;\n            background-color: #f5f5f5;\n        }\n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            background: white;\n            padding: 30px;\n            border-radius: 8px;\n            box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n        }\n        .header {\n            text-align: center;\n            border-bottom: 3px solid #2196F3;\n            padding-bottom: 20px;\n            margin-bottom: 30px;\n        }\n        .header h1 {\n            color: #2196F3;\n            margin: 0;\n        }\n        .summary {\n            background: #e3f2fd;\n            padding: 15px;\n            border-radius: 5px;\n            margin-bottom: 30px;\n        }\n        .document {\n            border: 1px solid #ddd;\n            margin-bottom: 20px;\n            padding: 20px;\n            border-radius: 5px;\n            background: #fafafa;\n        }\n        .document h3 {\n            color: #1976D2;\n            margin-top: 0;\n        }\n        .doc-meta {\n            background: #fff;\n            padding: 10px;\n            border-left: 4px solid #4CAF50;\n            margin: 10px 0;\n        }\n        .keywords {\n            background: #f0f0f0;\n            padding: 5px 10px;\n            border-radius: 15px;\n            display: inline-block;\n            margin: 2px;\n            font-size: 0.9em;\n        }\n        .citation {\n            background: #fff3e0;\n            padding: 10px;\n            border-left: 4px solid #FF9800;\n            margin-top: 10px;\n            font-style: italic;\n        }\n        .footer {\n            text-align: center;\n            margin-top: 40px;\n            padding-top: 20px;\n            border-top: 1px solid #ddd;\n            color: #666;\n        }\n        @media print {\n            body { background: white; }\n            .container { box-shadow: none; }\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <div class="header">\n            <h1>Transport Legislation Academic Report</h1>\n            <p>Brazilian Transport Legislation Monitor - Academic Research Platform</p>\n            <p>Gerado em: ${(new Date).toLocaleDateString("pt-BR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}</p>\n        </div>\n        \n        <div class="summary">\n            <h2>Resumo da Pesquisa</h2>\n            <p><strong>Total de documentos encontrados:</strong> ${e.length}</p>\n            <p><strong>Estados com legislação:</strong> ${[...new Set(e.filter(e=>e.state).map(e=>e.state))].length}</p>\n            <p><strong>Tipos de documentos:</strong> ${[...new Set(e.map(e=>e.type))].join(", ")}</p>\n            <p><strong>Período:</strong> ${(e=>{if(0===e.length)return"N/A";const t=e.map(e=>new Date(e.date)),n=new Date(Math.min.apply(null,t)),a=new Date(Math.max.apply(null,t));return`${n.toLocaleDateString("pt-BR")} a ${a.toLocaleDateString("pt-BR")}`})(e)}</p>\n        </div>\n        \n        <div class="documents">\n            ${e.map((e,n)=>`\n                <div class="document">\n                    <h3>${n+1}. ${A(e.title)}</h3>\n                    \n                    <div class="doc-meta">\n                        <strong>Tipo:</strong> ${e.type.charAt(0).toUpperCase()+e.type.slice(1)} | \n                        <strong>Número:</strong> ${A(e.number)} | \n                        <strong>Data:</strong> ${new Date(e.date).toLocaleDateString("pt-BR")}\n                        ${e.state?` | <strong>Estado:</strong> ${e.state}`:""}\n                        ${e.municipality?` | <strong>Município:</strong> ${A(e.municipality)}`:""}\n                    </div>\n                    \n                    <p><strong>Resumo:</strong> ${A(e.summary)}</p>\n                    \n                    <div>\n                        <strong>Palavras-chave:</strong><br>\n                        ${e.keywords.map(e=>`<span class="keywords">${A(e)}</span>`).join(" ")}\n                    </div>\n                    \n                    ${t.includeMetadata?`\n                        <div class="citation">\n                            <strong>Citação acadêmica:</strong><br>\n                            ${A(e.citation)}\n                            ${e.url?`<br><strong>URL:</strong> <a href="${e.url}" target="_blank">${e.url}</a>`:""}\n                        </div>\n                    `:""}\n                </div>\n            `).join("")}\n        </div>\n        \n        <div class="footer">\n            <p><strong>Citação sugerida para esta pesquisa:</strong></p>\n            <p>Academic Transport Legislation Monitor. Brazilian transport legislation georeferenced data. \n               Exportado em ${(new Date).toLocaleDateString("pt-BR")}. \n               Disponível em: [URL da aplicação].</p>\n            <p><em>Este relatório foi gerado automaticamente. Sempre verifique as fontes originais.</em></p>\n        </div>\n    </div>\n</body>\n</html>`;B(n,`transport-legislation-report-${(new Date).toISOString()}.html`,"text/html")})(i,e);break;case"bibtex":l=(e=>{const t=e.map(e=>{const t=e.source.includes("Câmara")?"Brasil. Câmara dos Deputados":e.source.includes("Senado")?"Brasil. Senado Federal":e.source.includes("LexML")?"Brasil. LexML":"Brasil",n=new Date(e.date).getFullYear();return`@legislation{${e.type}${e.number.replace(/[^0-9]/g,"")}${n},\n  title={${e.title}},\n  author={${t}},\n  year={${n}},\n  type={${e.type}},\n  number={${e.number}},\n  institution={${e.source}},\n  url={${e.url||""}},\n  note={Accessed: ${(new Date).toLocaleDateString("en-CA")}}\n}`}).join("\n\n"),n=`% BibTeX export from Brazilian Transport Legislation Monitor\n% Generated: ${(new Date).toISOString()}\n% Total entries: ${e.length}\n\n${t}`,a=new Blob([n],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(a),r=document.createElement("a");r.href=o,r.download=`transport-legislation-${(new Date).toISOString()}.bib`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)})(i);break;case"png":d?yield((e,t,...a)=>W(null,[e,t,...a],function*(e,t,a={}){const{filename:o="legislative-map-with-data"}=a;try{const n=H(e,t),i=document.querySelector(".map-wrapper");if(!i)throw new Error("Map container not found");i.appendChild(n);try{yield X((r=((e,t)=>{for(var n in t||(t={}))K.call(t,n)&&J(e,n,t[n]);if(q)for(var n of q(t))G.call(t,n)&&J(e,n,t[n]);return e})({},a),s={filename:o},F(r,_(s))))}finally{i.removeChild(n)}}catch(n){throw console.error("Map export with metadata failed:",n),n}var r,s}))(i,void 0,{format:"png",includeControls:!1,includeLegend:!0}):yield X({format:"png",includeControls:!1,includeLegend:!0})}if(l){const e=`monitor-legislativo-${s}-${Date.now()}.${s}`;v(l,e)}h("ready")}catch(n){console.error("Export failed:",n),h("idle"),alert("Erro ao exportar dados. Tente novamente.")}var t},new Promise((t,n)=>{var a=t=>{try{r(e.next(t))}catch(a){n(a)}},o=t=>{try{r(e.throw(t))}catch(a){n(a)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(a,o);r((e=e.apply(null,null)).next())});var e},disabled:0===o.length||"generating"===m,children:["checking"===m&&"🔍 Verificando cache...","generating"===m&&"⏳ Gerando exportação...","ready"===m&&"✅ Pronto!","idle"===m&&`Exportar ${"png"===s?"Imagem PNG":s.toUpperCase()}`]})]})]})}):null};export{ie as default};
