import{j as e}from"./index-BQzQLf5W.js";import{r as s,R as t}from"./leaflet-vendor-CuwtxqHJ.js";import"./react-vendor-DFJYf2oa.js";const a=({documents:t})=>{const a=s.useMemo(()=>{const e=new Date,s=new Date(e.getFullYear(),e.getMonth()-6,1),a=new Date(e.getFullYear()-1,e.getMonth(),1),r=new Map,l=new Map,n=new Map,i=new Map;t.forEach(e=>{r.set(e.type,(r.get(e.type)||0)+1),e.state&&l.set(e.state,(l.get(e.state)||0)+1);const s="string"==typeof e.date?new Date(e.date):e.date,t=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`;n.set(t,(n.get(t)||0)+1),e.keywords.forEach(e=>{i.set(e,(i.get(e)||0)+1)})});const c=t.length,o=Array.from(r.entries()).map(([e,s])=>({label:e,value:s,percentage:s/c*100})).sort((e,s)=>s.value-e.value),d=Array.from(l.entries()).map(([e,s])=>({label:e,value:s,percentage:s/c*100})).sort((e,s)=>s.value-e.value).slice(0,10),h=Array.from(i.entries()).map(([e,s])=>({label:e,value:s,percentage:s/c*100})).sort((e,s)=>s.value-e.value).slice(0,15),u=[];for(let t=11;t>=0;t--){const s=new Date(e.getFullYear(),e.getMonth()-t,1),a=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`,r=n.get(a)||0;u.push({label:s.toLocaleDateString("pt-BR",{month:"short",year:"2-digit"}),value:r,percentage:0})}const m=t.filter(e=>("string"==typeof e.date?new Date(e.date):e.date)>=s).length,p=t.filter(e=>("string"==typeof e.date?new Date(e.date):e.date)>=a).length;return{total:c,recentDocs:m,yearlyDocs:p,typeData:o,stateData:d,keywordData:h,monthlyData:u,averagePerMonth:Math.round(p/12)}},[t]),r=({data:s,maxValue:t})=>{const a=t||Math.max(...s.map(e=>e.value));return e.jsx("div",{className:"bar-chart",children:s.map((s,t)=>e.jsxs("div",{className:"bar-item",children:[e.jsx("div",{className:"bar-label",children:s.label}),e.jsx("div",{className:"bar-container",children:e.jsx("div",{className:"bar-fill",style:{width:s.value/a*100+"%"},children:e.jsx("span",{className:"bar-value",children:s.value})})}),s.percentage>0&&e.jsxs("div",{className:"bar-percentage",children:[s.percentage.toFixed(1),"%"]})]},t))})},l=({data:s})=>{const t=Math.max(...s.map(e=>e.value)),a=200,r=100;return e.jsx("div",{className:"line-chart",children:e.jsxs("svg",{viewBox:`0 0 ${r*s.length} 240`,preserveAspectRatio:"none",children:[[0,25,50,75,100].map(t=>e.jsx("line",{x1:"0",y1:a-a*t/100,x2:r*s.length,y2:a-a*t/100,stroke:"#e0e0e0",strokeWidth:"1"},t)),e.jsx("polyline",{points:s.map((e,s)=>`${s*r+50},${a-e.value/t*a}`).join(" "),fill:"none",stroke:"#1976d2",strokeWidth:"2"}),s.map((s,l)=>e.jsxs("g",{children:[e.jsx("circle",{cx:l*r+50,cy:a-s.value/t*a,r:"4",fill:"#1976d2"}),e.jsx("text",{x:l*r+50,y:220,textAnchor:"middle",fontSize:"12",fill:"#666",children:s.label}),e.jsx("text",{x:l*r+50,y:a-s.value/t*a-10,textAnchor:"middle",fontSize:"11",fill:"#333",fontWeight:"bold",children:s.value})]},l))]})})},n=({data:s})=>{const t=Math.max(...s.map(e=>e.value));return e.jsx("div",{className:"keyword-cloud",children:s.map((s,a)=>{const r=.8+s.value/t*1.2,l=.6+s.value/t*.4;return e.jsx("span",{className:"keyword-tag",style:{fontSize:`${r}rem`,opacity:l,color:`hsl(${200+10*a}, 70%, 45%)`},title:`${s.value} documents`,children:s.label},a)})})};return e.jsxs("div",{className:"data-visualization",children:[e.jsx("h2",{children:"Legislative Analytics Dashboard"}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📊"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:a.total}),e.jsx("div",{className:"stat-label",children:"Total Documents"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📅"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:a.recentDocs}),e.jsx("div",{className:"stat-label",children:"Last 6 Months"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"📈"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:a.averagePerMonth}),e.jsx("div",{className:"stat-label",children:"Avg. per Month"})]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:"🗓️"}),e.jsxs("div",{className:"stat-content",children:[e.jsx("div",{className:"stat-value",children:a.yearlyDocs}),e.jsx("div",{className:"stat-label",children:"This Year"})]})]})]}),e.jsxs("div",{className:"charts-grid",children:[e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:"Document Types Distribution"}),e.jsx(r,{data:a.typeData})]}),e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:"Top States by Legislation"}),e.jsx(r,{data:a.stateData})]}),e.jsxs("div",{className:"chart-container full-width",children:[e.jsx("h3",{children:"Monthly Trend (Last 12 Months)"}),e.jsx(l,{data:a.monthlyData})]}),e.jsxs("div",{className:"chart-container full-width",children:[e.jsx("h3",{children:"Popular Keywords"}),e.jsx(n,{data:a.keywordData})]})]}),e.jsx("div",{className:"visualization-actions",children:e.jsx("button",{className:"export-chart-btn",onClick:()=>{const e=[["Metric","Value"],["Total Documents",a.total],["Recent Documents (6 months)",a.recentDocs],["Yearly Documents",a.yearlyDocs],["Average per Month",a.averagePerMonth],"",["Document Type","Count","Percentage"],...a.typeData.map(e=>[e.label,e.value,e.percentage.toFixed(1)+"%"]),"",["State","Count","Percentage"],...a.stateData.map(e=>[e.label,e.value,e.percentage.toFixed(1)+"%"])].map(e=>e.join(",")).join("\n"),s=new Blob([e],{type:"text/csv"}),t=URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=`legislative-analytics-${(new Date).toISOString().split("T")[0]}.csv`,r.click(),URL.revokeObjectURL(t)},children:"📥 Export Analytics (CSV)"})})]})};var r=Object.defineProperty,l=Object.defineProperties,n=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,d=(e,s,t)=>s in e?r(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,h=(e,s)=>{for(var t in s||(s={}))c.call(s,t)&&d(e,t,s[t]);if(i)for(var t of i(s))o.call(s,t)&&d(e,t,s[t]);return e},u=(e,s)=>l(e,n(s)),m=(e,s,t)=>d(e,"symbol"!=typeof s?s+"":s,t);const p="monitor_legislativo_saved_queries",x=class e{constructor(){m(this,"queries",[]),this.loadQueries()}static getInstance(){return e.instance||(e.instance=new e),e.instance}loadQueries(){try{const e=localStorage.getItem(p);e&&(this.queries=JSON.parse(e))}catch(e){console.error("Error loading saved queries:",e),this.queries=[]}}saveQueries(){try{localStorage.setItem(p,JSON.stringify(this.queries))}catch(e){console.error("Error saving queries:",e)}}generateId(){return`query_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getAllQueries(){return[...this.queries].sort((e,s)=>new Date(s.updatedAt).getTime()-new Date(e.updatedAt).getTime())}getPublicQueries(){return this.queries.filter(e=>e.isPublic)}getRecentQueries(e=5){return this.getAllQueries().slice(0,e)}getPopularQueries(e=5){return[...this.queries].sort((e,s)=>s.timesUsed-e.timesUsed).slice(0,e)}getQueryById(e){return this.queries.find(s=>s.id===e)}saveQuery(e,s,t={}){var a;const r=(new Date).toISOString(),l={id:this.generateId(),name:e.trim(),description:null==(a=t.description)?void 0:a.trim(),filters:h({},s),createdAt:r,updatedAt:r,timesUsed:0,isPublic:t.isPublic||!1,tags:t.tags||[]};return this.queries.push(l),this.saveQueries(),l}updateQuery(e,s){const t=this.queries.findIndex(s=>s.id===e);if(-1===t)return null;const a=this.queries[t];return this.queries[t]=u(h(h({},a),s),{updatedAt:(new Date).toISOString()}),this.saveQueries(),this.queries[t]}deleteQuery(e){const s=this.queries.findIndex(s=>s.id===e);return-1!==s&&(this.queries.splice(s,1),this.saveQueries(),!0)}useQuery(e){const s=this.getQueryById(e);return s?(s.timesUsed++,s.updatedAt=(new Date).toISOString(),this.saveQueries(),s):null}duplicateQuery(e,s){const t=this.getQueryById(e);return t?this.saveQuery(s,t.filters,{description:t.description,isPublic:!1,tags:[...t.tags]}):null}searchQueries(e){const s=e.toLowerCase();return this.queries.filter(e=>{var t;return e.name.toLowerCase().includes(s)||(null==(t=e.description)?void 0:t.toLowerCase().includes(s))||e.tags.some(e=>e.toLowerCase().includes(s))||e.filters.searchTerm.toLowerCase().includes(s)})}getQueriesByTag(e){return this.queries.filter(s=>s.tags.some(s=>s.toLowerCase()===e.toLowerCase()))}getAllTags(){const e=new Set;return this.queries.forEach(s=>{s.tags.forEach(s=>e.add(s))}),Array.from(e).sort()}exportQueries(){return JSON.stringify(this.queries,null,2)}importQueries(e){try{const s=JSON.parse(e);if(!Array.isArray(s))return{success:!1,imported:0,errors:["Invalid format: expected array"]};const t=[];let a=0;return s.forEach((e,s)=>{try{if(!this.isValidQuery(e))return void t.push(`Query ${s+1}: Invalid format`);if(this.queries.find(s=>s.name===e.name))return void t.push(`Query "${e.name}": Name already exists`);const r=u(h({},e),{id:this.generateId(),createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),timesUsed:0});this.queries.push(r),a++}catch(r){t.push(`Query ${s+1}: ${r instanceof Error?r.message:"Unknown error"}`)}}),a>0&&this.saveQueries(),{success:a>0,imported:a,errors:t}}catch(s){return{success:!1,imported:0,errors:[`Parse error: ${s instanceof Error?s.message:"Unknown error"}`]}}}isValidQuery(e){return"object"==typeof e&&null!==e&&"string"==typeof e.name&&e.name.trim().length>0&&"object"==typeof e.filters&&null!==e.filters&&"string"==typeof e.filters.searchTerm&&Array.isArray(e.filters.documentTypes)&&Array.isArray(e.filters.states)&&Array.isArray(e.filters.keywords)&&"boolean"==typeof e.isPublic&&Array.isArray(e.tags)}clearAllQueries(){this.queries=[],this.saveQueries()}getStats(){const e=this.queries.length,s=this.queries.filter(e=>e.isPublic).length,t=this.queries.reduce((e,s)=>e+s.timesUsed,0);return{total:e,public:s,private:e-s,mostUsed:this.queries.length>0?this.queries.reduce((e,s)=>s.timesUsed>e.timesUsed?s:e):null,totalUsage:t}}};m(x,"instance");const j=x.getInstance(),g=({isOpen:t,onClose:a,onSave:r,filters:l})=>{const[n,i]=s.useState(""),[c,o]=s.useState(""),[d,h]=s.useState(!1),[u,m]=s.useState(""),[p,x]=s.useState("");return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Salvar Consulta"}),e.jsx("button",{className:"modal-close",onClick:a,children:"×"})]}),e.jsxs("div",{className:"modal-body",children:[p&&e.jsx("div",{className:"error-message",children:p}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"query-name",children:"Nome da Consulta *"}),e.jsx("input",{id:"query-name",type:"text",value:n,onChange:e=>i(e.target.value),placeholder:"Ex: Documentos sobre transporte público",maxLength:100})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"query-description",children:"Descrição"}),e.jsx("textarea",{id:"query-description",value:c,onChange:e=>o(e.target.value),placeholder:"Descrição opcional da consulta",rows:3,maxLength:500})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"query-tags",children:"Tags (separadas por vírgula)"}),e.jsx("input",{id:"query-tags",type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"Ex: transporte, infraestrutura, mobilidade"})]}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:e=>h(e.target.checked)}),"Tornar consulta pública"]})}),e.jsxs("div",{className:"query-preview",children:[e.jsx("h4",{children:"Preview da Consulta:"}),e.jsxs("div",{className:"preview-content",children:[l.searchTerm&&e.jsxs("span",{className:"preview-tag",children:['Busca: "',l.searchTerm,'"']}),l.documentTypes.length>0&&e.jsxs("span",{className:"preview-tag",children:["Tipos: ",l.documentTypes.join(", ")]}),l.states.length>0&&e.jsxs("span",{className:"preview-tag",children:["Estados: ",l.states.join(", ")]}),l.keywords.length>0&&e.jsxs("span",{className:"preview-tag",children:["Palavras-chave: ",l.keywords.join(", ")]}),l.dateFrom&&e.jsxs("span",{className:"preview-tag",children:["De: ",l.dateFrom.toLocaleDateString()]}),l.dateTo&&e.jsxs("span",{className:"preview-tag",children:["Até: ",l.dateTo.toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn-secondary",onClick:a,children:"Cancelar"}),e.jsx("button",{className:"btn-primary",onClick:()=>{if(!n.trim())return void x("Nome é obrigatório");const e=u.split(",").map(e=>e.trim()).filter(e=>e.length>0);r(n.trim(),c.trim(),d,e),i(""),o(""),h(!1),m(""),x("")},children:"Salvar Consulta"})]})]})}):null},v=({isOpen:a,onClose:r,onLoadQuery:l,currentFilters:n})=>{const[i,c]=s.useState([]),[o,d]=s.useState(""),[h,u]=s.useState(""),[m,p]=s.useState(!1),[x,v]=s.useState("all"),[y,b]=s.useState("date");s.useEffect(()=>{N()},[]);const N=()=>{c(j.getAllQueries())},f=t.useMemo(()=>{let e=i;switch(x){case"recent":e=j.getRecentQueries();break;case"popular":e=j.getPopularQueries();break;case"public":e=j.getPublicQueries();break;default:e=i}switch(o&&(e=j.searchQueries(o)),h&&(e=e.filter(e=>e.tags.includes(h))),y){case"name":e.sort((e,s)=>e.name.localeCompare(s.name));break;case"usage":e.sort((e,s)=>s.timesUsed-e.timesUsed);break;default:e.sort((e,s)=>new Date(s.updatedAt).getTime()-new Date(e.updatedAt).getTime())}return e},[i,o,h,x,y]),w=e=>{const s=[];return e.searchTerm&&s.push(`"${e.searchTerm}"`),e.documentTypes.length>0&&s.push(`Tipos: ${e.documentTypes.length}`),e.states.length>0&&s.push(`Estados: ${e.states.length}`),e.keywords.length>0&&s.push(`Tags: ${e.keywords.length}`),s.join(" • ")},C=j.getAllTags(),k=j.getStats();return a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"saved-queries-overlay",onClick:r,children:e.jsxs("div",{className:"saved-queries-panel",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h2",{children:"Consultas Salvas"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"btn-primary btn-small",onClick:()=>p(!0),disabled:!n.searchTerm&&0===n.documentTypes.length,children:"💾 Salvar Atual"}),e.jsx("button",{className:"panel-close",onClick:r,children:"×"})]})]}),e.jsxs("div",{className:"panel-content",children:[e.jsxs("div",{className:"stats-bar",children:[e.jsxs("span",{children:[k.total," consultas"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[k.totalUsage," usos"]}),k.mostUsed&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:['Mais usada: "',k.mostUsed.name,'" (',k.mostUsed.timesUsed,"x)"]})]})]}),e.jsxs("div",{className:"search-controls",children:[e.jsx("input",{type:"text",placeholder:"Buscar consultas...",value:o,onChange:e=>d(e.target.value),className:"search-input"}),e.jsxs("select",{value:h,onChange:e=>u(e.target.value),className:"tag-filter",children:[e.jsx("option",{value:"",children:"Todas as tags"}),C.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{value:y,onChange:e=>b(e.target.value),className:"sort-select",children:[e.jsx("option",{value:"date",children:"Por data"}),e.jsx("option",{value:"name",children:"Por nome"}),e.jsx("option",{value:"usage",children:"Por uso"})]})]}),e.jsxs("div",{className:"tabs",children:[e.jsxs("button",{className:"tab "+("all"===x?"active":""),onClick:()=>v("all"),children:["Todas (",k.total,")"]}),e.jsx("button",{className:"tab "+("recent"===x?"active":""),onClick:()=>v("recent"),children:"Recentes"}),e.jsx("button",{className:"tab "+("popular"===x?"active":""),onClick:()=>v("popular"),children:"Populares"}),e.jsxs("button",{className:"tab "+("public"===x?"active":""),onClick:()=>v("public"),children:["Públicas (",k.public,")"]})]}),e.jsx("div",{className:"queries-list",children:0===f.length?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"Nenhuma consulta encontrada."}),"all"===x&&!o&&e.jsx("button",{className:"btn-primary",onClick:()=>p(!0),disabled:!n.searchTerm&&0===n.documentTypes.length,children:"Salvar primeira consulta"})]}):f.map(s=>e.jsxs("div",{className:"query-item",children:[e.jsxs("div",{className:"query-main",children:[e.jsxs("div",{className:"query-header",children:[e.jsx("h4",{className:"query-name",children:s.name}),e.jsxs("div",{className:"query-meta",children:[s.isPublic&&e.jsx("span",{className:"public-badge",children:"Público"}),e.jsxs("span",{className:"usage-count",children:[s.timesUsed," usos"]}),e.jsx("span",{className:"query-date",children:new Date(s.updatedAt).toLocaleDateString()})]})]}),s.description&&e.jsx("p",{className:"query-description",children:s.description}),e.jsx("div",{className:"query-filters",children:w(s.filters)}),s.tags.length>0&&e.jsx("div",{className:"query-tags",children:s.tags.map(s=>e.jsx("span",{className:"tag",children:s},s))})]}),e.jsxs("div",{className:"query-actions",children:[e.jsx("button",{className:"btn-primary btn-small",onClick:()=>(e=>{j.useQuery(e.id),l(e.filters),N()})(s),children:"Usar"}),e.jsx("button",{className:"btn-secondary btn-small",onClick:()=>(e=>{const s=`${e.name} (cópia)`;j.duplicateQuery(e.id,s),N()})(s),children:"Duplicar"}),e.jsx("button",{className:"btn-danger btn-small",onClick:()=>{return e=s.id,void(confirm("Tem certeza que deseja excluir esta consulta?")&&(j.deleteQuery(e),N()));var e},children:"Excluir"})]})]},s.id))})]})]})}),e.jsx(g,{isOpen:m,onClose:()=>p(!1),onSave:(e,s,t,a)=>{try{j.saveQuery(e,n,{description:s,isPublic:t,tags:a}),N(),p(!1)}catch(r){console.error("Error saving query:",r)}},filters:n})]}):null};var y=Object.defineProperty,b=Object.defineProperties,N=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,w=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable,k=(e,s,t)=>s in e?y(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,S=(e,s)=>{for(var t in s||(s={}))w.call(s,t)&&k(e,t,s[t]);if(f)for(var t of f(s))C.call(s,t)&&k(e,t,s[t]);return e},T=(e,s)=>b(e,N(s));const D=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"],A=({filters:t,onFiltersChange:a,documents:r,selectedState:l,onClearSelection:n})=>{const[i,c]=s.useState(!1),[o,d]=s.useState(-1),[h,u]=s.useState([]),[m,p]=s.useState(!1),[x,j]=s.useState(t),[g,y]=s.useState(!1),b=s.useRef(null),N=s.useRef(null),f=s.useRef(null);s.useEffect(()=>{j(t)},[t]);const w=s.useCallback(e=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{console.log("🎯 Filter batch: Applying batched filter changes",{searchTerm:e.searchTerm,filtersCount:Object.keys(e).filter(s=>{const t=e[s];return Array.isArray(t)?t.length>0:!!t}).length}),a(e)},300)},[a]),C=s.useCallback(e=>{const s=S(S({},x),e);j(s),w(s)},[x,w]);s.useEffect(()=>{const e=localStorage.getItem("searchHistory");e&&u(JSON.parse(e))},[]),s.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const k=s.useMemo(()=>{const e=new Map,s=new Map,t=new Map,a=new Map;return r.forEach(r=>{e.set(r.type,(e.get(r.type)||0)+1),r.state&&s.set(r.state,(s.get(r.state)||0)+1),r.chamber&&t.set(r.chamber,(t.get(r.chamber)||0)+1),r.keywords.forEach(e=>{a.set(e,(a.get(e)||0)+1)})}),{typeCounts:e,stateCounts:s,chamberCounts:t,keywordCounts:a}},[r]),A=s.useMemo(()=>{if(!x.searchTerm||x.searchTerm.length<2)return[];const e=x.searchTerm.toLowerCase(),s=[];return Array.from(k.keywordCounts.entries()).filter(([s])=>s.toLowerCase().includes(e)).sort((e,s)=>s[1]-e[1]).slice(0,5).forEach(([e,t])=>{s.push({text:e,type:"keyword",count:t})}),r.filter(s=>s.title.toLowerCase().includes(e)).slice(0,3).forEach(e=>{s.push({text:e.title,type:"title"})}),h.filter(s=>s.toLowerCase().includes(e)&&s!==x.searchTerm).slice(0,2).forEach(e=>{s.push({text:e,type:"recent"})}),s},[x.searchTerm,k,r,h]),q=e=>{const s=e||t.searchTerm;if(s.trim()){const e=[s,...h.filter(e=>e!==s)].slice(0,10);u(e),localStorage.setItem("searchHistory",JSON.stringify(e))}c(!1)},P=e=>{C({searchTerm:e.text}),q(e.text)},O=e=>{const s=x.documentTypes.includes(e)?x.documentTypes.filter(s=>s!==e):[...x.documentTypes,e];C({documentTypes:s})},Q=e=>{const s=x.states.includes(e)?x.states.filter(s=>s!==e):[...x.states,e];C({states:s})},L=e=>{const s=x.chambers.includes(e)?x.chambers.filter(s=>s!==e):[...x.chambers,e];C({chambers:s})},E=e=>{const s=x.keywords.includes(e)?x.keywords.filter(s=>s!==e):[...x.keywords,e];C({keywords:s})},M=t.documentTypes.length>0||t.states.length>0||t.keywords.length>0||t.dateFrom||t.dateTo||t.searchTerm.trim();return s.useEffect(()=>{const e=e=>{N.current&&!N.current.contains(e.target)&&b.current&&!b.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),e.jsxs("div",{className:"enhanced-search",children:[e.jsxs("div",{className:"search-section",children:[e.jsxs("div",{className:"search-header",children:[e.jsx("h3",{children:"Buscar Documentos"}),e.jsx("button",{className:"saved-queries-btn",onClick:()=>y(!0),"aria-label":"Consultas salvas",children:"📚 Consultas Salvas"})]}),e.jsxs("div",{className:"search-input-container",children:[e.jsx("input",{ref:b,type:"text",placeholder:"Digite palavras-chave, título ou autor...",value:x.searchTerm,onChange:e=>{const s=e.target.value;C({searchTerm:s}),c(!0),d(-1)},onKeyDown:e=>{if(i&&0!==A.length)switch(e.key){case"ArrowDown":e.preventDefault(),d(e=>e<A.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),d(e=>e>0?e-1:A.length-1);break;case"Enter":e.preventDefault(),o>=0?P(A[o]):q();break;case"Escape":c(!1),d(-1)}},onFocus:()=>x.searchTerm&&c(!0),className:"search-input","aria-label":"Buscar documentos"}),e.jsx("button",{className:"search-button",onClick:()=>w(x),"aria-label":"Buscar",children:"🔍"}),i&&A.length>0&&e.jsx("div",{ref:N,className:"search-suggestions",children:A.map((s,t)=>e.jsxs("div",{className:"suggestion-item "+(t===o?"selected":""),onClick:()=>P(s),children:[e.jsxs("span",{className:`suggestion-icon ${s.type}`,children:["keyword"===s.type&&"🏷️","title"===s.type&&"📄","author"===s.type&&"👤","recent"===s.type&&"🕐"]}),e.jsx("span",{className:"suggestion-text",children:s.text}),s.count&&e.jsxs("span",{className:"suggestion-count",children:["(",s.count,")"]})]},t))})]})]}),e.jsxs("div",{className:"quick-filters",children:[e.jsx("h4",{children:"Filtros Rápidos"}),e.jsx("div",{className:"filter-chips",children:Array.from(k.keywordCounts.entries()).sort((e,s)=>s[1]-e[1]).slice(0,8).map(([s,a])=>e.jsxs("button",{className:"filter-chip "+(t.keywords.includes(s)?"selected":""),onClick:()=>E(s),children:[s," (",a,")"]},s))})]}),e.jsxs("button",{className:"advanced-toggle",onClick:()=>p(!m),"aria-expanded":m,children:[m?"▼":"▶"," Filtros Avançados"]}),m&&e.jsxs("div",{className:"advanced-filters",children:[e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{children:"Período"}),e.jsxs("div",{className:"date-range",children:[e.jsx("input",{type:"date",value:t.dateFrom?t.dateFrom.toISOString().split("T")[0]:"",onChange:e=>a(T(S({},t),{dateFrom:e.target.value?new Date(e.target.value):void 0})),"aria-label":"Data inicial"}),e.jsx("span",{children:"até"}),e.jsx("input",{type:"date",value:t.dateTo?t.dateTo.toISOString().split("T")[0]:"",onChange:e=>a(T(S({},t),{dateTo:e.target.value?new Date(e.target.value):void 0})),"aria-label":"Data final"})]})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{children:"Tipos de Documento"}),e.jsx("div",{className:"checkbox-group",children:Array.from(k.typeCounts.entries()).sort((e,s)=>s[1]-e[1]).map(([s,a])=>e.jsxs("label",{className:"checkbox-item",children:[e.jsx("input",{type:"checkbox",checked:t.documentTypes.includes(s),onChange:()=>O(s)}),e.jsxs("span",{className:"checkbox-label",children:[s," (",a,")"]})]},s))})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{children:"Origem Legislativa"}),e.jsx("div",{className:"checkbox-group",children:Array.from(k.chamberCounts.entries()).sort((e,s)=>s[1]-e[1]).map(([s,a])=>e.jsxs("label",{className:"checkbox-item",children:[e.jsx("input",{type:"checkbox",checked:t.chambers.includes(s),onChange:()=>L(s)}),e.jsxs("span",{className:"checkbox-label",children:[s," (",a,")"]})]},s))})]}),e.jsxs("div",{className:"filter-section",children:[e.jsx("h4",{children:"Estados"}),e.jsx("div",{className:"states-grid",children:D.map(s=>{const a=k.stateCounts.get(s)||0;return 0===a?null:e.jsxs("label",{className:"state-item",children:[e.jsx("input",{type:"checkbox",checked:t.states.includes(s),onChange:()=>Q(s)}),e.jsxs("span",{children:[s," (",a,")"]})]},s)})})]})]}),M&&e.jsxs("div",{className:"active-filters",children:[e.jsxs("div",{className:"active-filters-header",children:[e.jsx("span",{children:"Filtros ativos:"}),e.jsx("button",{className:"clear-all",onClick:()=>{const e={searchTerm:"",documentTypes:[],states:[],municipalities:[],chambers:[],keywords:[],dateFrom:void 0,dateTo:void 0};j(e),a(e)},children:"Limpar todos"})]}),e.jsxs("div",{className:"filter-tags",children:[t.searchTerm&&e.jsxs("span",{className:"filter-tag",children:['Busca: "',t.searchTerm,'"',e.jsx("button",{onClick:()=>a(T(S({},t),{searchTerm:""})),children:"×"})]}),t.documentTypes.map(s=>e.jsxs("span",{className:"filter-tag",children:[s,e.jsx("button",{onClick:()=>O(s),children:"×"})]},s)),t.states.map(s=>e.jsxs("span",{className:"filter-tag",children:[s,e.jsx("button",{onClick:()=>Q(s),children:"×"})]},s)),t.chambers.map(s=>e.jsxs("span",{className:"filter-tag",children:[s,e.jsx("button",{onClick:()=>L(s),children:"×"})]},s)),t.keywords.map(s=>e.jsxs("span",{className:"filter-tag",children:[s,e.jsx("button",{onClick:()=>E(s),children:"×"})]},s))]})]}),l&&e.jsxs("div",{className:"selected-state",children:[e.jsxs("span",{children:["Estado selecionado: ",l]}),e.jsx("button",{onClick:n,children:"Limpar seleção"})]}),e.jsx(v,{isOpen:g,onClose:()=>y(!1),onLoadQuery:e=>{j(e),a(e),y(!1)},currentFilters:t})]})},q=({isOpen:t,onToggle:r,filters:l,onFiltersChange:n,documents:i,selectedState:c,onClearSelection:o})=>{const[d,h]=s.useState("search"),u=i.filter(e=>!(l.searchTerm&&!e.title.toLowerCase().includes(l.searchTerm.toLowerCase())&&!e.summary.toLowerCase().includes(l.searchTerm.toLowerCase())&&!e.keywords.some(e=>e.toLowerCase().includes(l.searchTerm.toLowerCase())))&&(!(l.documentTypes.length>0&&!l.documentTypes.includes(e.type))&&(!(l.chambers.length>0&&e.chamber&&!l.chambers.includes(e.chamber))&&(!(l.dateFrom&&("string"==typeof e.date?new Date(e.date):e.date)<l.dateFrom)&&(!(l.dateTo&&("string"==typeof e.date?new Date(e.date):e.date)>l.dateTo)&&(!c||e.state===c))))));return e.jsxs("aside",{className:"tabbed-sidebar "+(t?"open":"closed"),role:"complementary","aria-labelledby":"sidebar-title",children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("h2",{id:"sidebar-title",children:"Monitor Legislativo"}),e.jsx("button",{className:"sidebar-toggle",onClick:r,"aria-label":t?"Fechar painel lateral":"Abrir painel lateral","aria-expanded":t,children:t?"◀":"▶"})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"sidebar-tabs",children:[e.jsx("button",{className:"tab-button "+("search"===d?"active":""),onClick:()=>h("search"),"aria-selected":"search"===d,children:"🔍 Search & Filters"}),e.jsx("button",{className:"tab-button "+("analytics"===d?"active":""),onClick:()=>h("analytics"),"aria-selected":"analytics"===d,children:"📊 Analytics"}),e.jsx("button",{className:"tab-button "+("rshiny"===d?"active":""),onClick:()=>h("rshiny"),"aria-selected":"rshiny"===d,children:"🔬 R Analytics"})]}),e.jsxs("div",{className:"sidebar-content",children:["search"===d&&e.jsxs("div",{className:"search-tab",children:[e.jsx(A,{filters:l,onFiltersChange:n,documents:i,selectedState:c,onClearSelection:o}),e.jsxs("div",{className:"results-summary",children:[e.jsx("h3",{children:"Resultados"}),e.jsxs("p",{children:[u.length," documentos encontrados"]})]}),e.jsx("div",{className:"document-list",children:u.map(s=>e.jsxs("div",{className:"document-item",children:[e.jsx("h4",{children:s.title}),e.jsx("p",{className:"document-type",children:s.type}),s.chamber&&e.jsxs("p",{className:"document-chamber",children:["Origem: ",s.chamber]}),e.jsx("p",{className:"document-date",children:"string"==typeof s.date?new Date(s.date).toLocaleDateString():s.date.toLocaleDateString()}),s.state&&e.jsxs("p",{className:"document-location",children:["Estado: ",s.state]})]},s.id))})]}),"analytics"===d&&e.jsx("div",{className:"analytics-tab",children:e.jsx(a,{documents:u})}),"rshiny"===d&&e.jsx("div",{className:"rshiny-tab",children:e.jsxs("div",{className:"rshiny-info",children:[e.jsx("h3",{children:"🔬 R Analytics Dashboard"}),e.jsx("p",{children:"Advanced statistical analysis and visualizations powered by R Shiny."}),e.jsxs("div",{className:"rshiny-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:u.length}),e.jsx("span",{className:"stat-label",children:"Documents"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:new Set(u.map(e=>e.state)).size}),e.jsx("span",{className:"stat-label",children:"States"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:new Set(u.map(e=>e.type)).size}),e.jsx("span",{className:"stat-label",children:"Types"})]})]}),e.jsxs("div",{className:"rshiny-features",children:[e.jsx("h4",{children:"Available Analyses:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"📈 Statistical distributions"}),e.jsx("li",{children:"🗺️ Interactive geographic analysis"}),e.jsx("li",{children:"📊 Time series analysis"}),e.jsx("li",{children:"🔗 Network analysis"}),e.jsx("li",{children:"📋 Custom report generation"})]})]}),e.jsx("div",{className:"rshiny-note",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," The R Shiny application runs independently and provides advanced analytics capabilities beyond the standard dashboard visualizations."]})})]})})]})]})]})};var P=q;export{q as TabbedSidebar,P as default};
