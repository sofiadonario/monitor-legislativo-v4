const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/OptimizedMap-CAu2bEk7.js","assets/js/index-BQzQLf5W.js","assets/js/react-vendor-DFJYf2oa.js","assets/js/leaflet-vendor-CuwtxqHJ.js","assets/css/index-dFeUauVP.css","assets/css/OptimizedMap-BtbebmC0.css","assets/js/TabbedSidebar-ip4jn3k1.js","assets/css/TabbedSidebar-k2yQqi_E.css","assets/js/ExportPanel-DDJjEkzN.js","assets/js/api-BEIyjD6w.js","assets/js/utils-Ck0FxTy8.js","assets/css/ExportPanel-tn0RQdqM.css","assets/js/AIResearchAssistant-DCZa6LRP.js","assets/js/DocumentValidationPanel-C707-CDs.js"])))=>i.map(i=>d[i]);
import{_ as e,j as t,L as s}from"./index-BQzQLf5W.js";import{r}from"./leaflet-vendor-CuwtxqHJ.js";import{A as a,g as o}from"./api-BEIyjD6w.js";var n=(e,t,s)=>new Promise((r,a)=>{var o=e=>{try{i(s.next(e))}catch(t){a(t)}},n=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,n);i((s=s.apply(e,t)).next())});function i(e){const t=e.split(":");let s,r,a,o,n,i="lei";if(t.length>2){const e=t[2];if(e.includes("congresso.nacional")?n="Congresso Nacional":e.includes("camara.leg.br")||e.includes("camara.municipal")?n="Câmara dos Deputados":e.includes("senado.leg.br")?n="Senado Federal":e.includes("federal")||"br"===e?n="DOU/Planalto":e.includes("estadual")?n="Governo Estadual":e.includes("municipal")?n="Governo Municipal":e.includes("tribunal")&&(n="Poder Judiciário"),e&&"br"!==e){const t=e.split(";");if(t.length>0){const e=t[0];if(e.includes(".")){const[t,a]=e.split(".");s=l(t),a&&(r=function(e){return e.split(".").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}(a))}else s=l(e)}}}if(t.length>3){const e=t[3];i=e.includes(":")?e.split(":")[0]:e,i=function(e){return{lei:"lei",decreto:"decreto","decreto.lei":"decreto_lei","medida.provisoria":"medida_provisoria",portaria:"portaria",resolucao:"resolucao",acordao:"acordao","instrucao.normativa":"instrucao_normativa","emenda.constitucional":"emenda_constitucional"}[e]||e}(i)}if(t.length>4){const e=t[t.length-1],s=t[t.length-2];if(s&&s.match(/\d{4}-\d{2}-\d{2}/))try{o=new Date(s)}catch(c){o=new Date}e&&e.match(/\d+/)&&(a=e.replace(/[^\d]/g,""))}return{state:s,municipality:r,type:i,number:a,date:o,chamber:n}}function l(e){return{"sao.paulo":"SP","rio.de.janeiro":"RJ","minas.gerais":"MG","rio.grande.sul":"RS",parana:"PR",bahia:"BA","distrito.federal":"DF","espirito.santo":"ES",goias:"GO","santa.catarina":"SC",ceara:"CE",pernambuco:"PE",para:"PA",maranhao:"MA",paraiba:"PB",alagoas:"AL",sergipe:"SE",rondonia:"RO",acre:"AC",amazonas:"AM",roraima:"RR",amapa:"AP",tocantins:"TO","mato.grosso":"MT","mato.grosso.sul":"MS","piauí":"PI"}[e]||e.toUpperCase()}function c(e,t){const s=new Set;return s.add(e.toLowerCase()),t.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>3).forEach(e=>s.add(e)),["transporte","rodoviário","carga","logística","frete","fretamento","caminhão","veículo","rodovia","tráfego"].forEach(e=>{t.toLowerCase().includes(e)&&s.add(e)}),Array.from(s).slice(0,8)}function u(e){const t=[];let s="",r=!1;for(let a=0;a<e.length;a++){const o=e[a];'"'===o&&"\\\\"!==e[a-1]?r=!r:","!==o||r?s+=o:(t.push(s.trim().replace(/^"|"$/g,"")),s="")}return t.push(s.trim().replace(/^"|"$/g,"")),t}function d(e,t){var s,r;const a=e.date?e.date.getFullYear():(new Date).getFullYear(),o=e.state||"BRASIL";return"lei"===e.type&&e.number?`${o}. Lei nº ${e.number}, de ${(null==(s=e.date)?void 0:s.toLocaleDateString("pt-BR"))||"data não informada"}. Disponível em: ${e.url}. Acesso em: ${(new Date).toLocaleDateString("pt-BR")}.`:"decreto"===e.type&&e.number?`${o}. Decreto nº ${e.number}, de ${(null==(r=e.date)?void 0:r.toLocaleDateString("pt-BR"))||"data não informada"}. Disponível em: ${e.url}. Acesso em: ${(new Date).toLocaleDateString("pt-BR")}.`:`${e.title}. ${o}, ${a}. Disponível em: ${e.url}. Acesso em: ${(new Date).toLocaleDateString("pt-BR")}.`}function h(){return n(this,null,function*(){const t="/monitor-legislativo-v4/lexml_transport_results_20250606_123100.csv";console.log(`Fetching real CSV data from: ${t}`);try{const s=yield fetch(t);if(!s.ok){console.warn(`CSV file not accessible (${s.status}), falling back to embedded real data`);const{realLegislativeData:t,validateDataIntegrity:r}=yield e(()=>import("./real-legislative-data-Deyn3_ij.js"),[]);if(!r())throw new Error("Embedded real data failed integrity validation");return console.log(`Using embedded real legislative data: ${t.length} documents from LexML`),t}let r=yield s.text();if(!r)throw new Error("CSV file is empty or could not be read.");r=r.replace(/^\uFEFF/,""),console.log("CSV content first 100 chars:",r.substring(0,100));const a=function(e){const t=e.split(/\r?\n/).filter(e=>""!==e.trim());if(console.log(`CSV split into ${t.length} lines`),t.length<2)return console.warn("CSV content has no data rows."),[];t[0]&&(t[0]=t[0].replace(/^\uFEFF/,""));const s=u(t[0]).map(e=>e.trim().replace(/['"]+/g,""));console.log("CSV Headers:",s),console.log("First line raw:",t[0].substring(0,50));const r=[];for(let a=1;a<t.length;a++){const e=t[a];if(!e)continue;const o=u(e);if(o.length!==s.length){console.warn(`Skipping malformed CSV row ${a+1}: Expected ${s.length} fields, but found ${o.length}. Line: "${e}"`);continue}const n={search_term:o[0]||"",date_searched:o[1]||"",url:o[2]||"",title:o[3]||"No Title Provided",urn:o[4]||""};if(!n.urn){console.warn(`Skipping row ${a+1} due to missing URN.`);continue}const{state:l,municipality:h,type:m,number:g,date:p,chamber:f}=i(n.urn),y=p||new Date;r.push({id:n.urn,title:n.title,summary:`Document retrieved on ${n.date_searched} for search term "${n.search_term}".`,type:m||"lei",date:y.toISOString(),keywords:c(n.search_term,n.title),state:l||"Federal",municipality:h,url:n.url,status:"sancionado",chamber:f||"Unknown",number:g,source:"LexML",citation:d({title:n.title,url:n.url,date:y,state:l,type:m,number:g})})}return console.log(`Successfully parsed ${r.length} documents from CSV.`),r}(r);if(0===a.length)throw new Error("CSV file contains no valid legislative documents.");return console.log(`Successfully loaded ${a.length} documents from CSV file`),a}catch(s){console.error("Error loading CSV legislative data:",s);try{const{realLegislativeData:t,validateDataIntegrity:s}=yield e(()=>import("./real-legislative-data-Deyn3_ij.js"),[]);if(!s())throw new Error("Embedded real data failed integrity validation");return console.log(`Fallback: Using embedded real legislative data: ${t.length} documents from LexML`),t}catch(r){throw console.error("Even embedded real data failed to load:",r),new Error("Unable to load any real legislative data source. Please check data availability.")}}})}let m=null;n(null,null,function*(){try{console.log("🔥 LOADING REAL LEGISLATIVE DATA..."),m=yield h(),m&&m.length>0?console.log(`✅ SUCCESS: Loaded ${m.length} real documents`):console.error("❌ Data loading failed - no data returned")}catch(e){console.error("❌ CRITICAL: Failed to load real legislative data on module import:",e),console.error("🚨 Academic integrity requires real data sources only"),console.error("📋 Action required: Check data availability or API connectivity")}});var g=Object.defineProperty,p=Object.defineProperties,f=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertySymbols,S=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,E=(e,t,s)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,C=(e,t,s)=>E(e,"symbol"!=typeof t?t+"":t,s),v=(e,t,s)=>new Promise((r,a)=>{var o=e=>{try{i(s.next(e))}catch(t){a(t)}},n=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,n);i((s=s.apply(e,t)).next())});class A extends Error{constructor(e,t){super(e),this.statusCode=t,this.name="ApiError"}}var T=new class{constructor(e){var t,s,r,a;C(this,"config"),C(this,"cache",new Map),this.config={baseUrl:e.baseUrl,version:e.version,timeout:null!=(t=e.timeout)?t:3e4,retries:null!=(s=e.retries)?s:3,cacheEnabled:null==(r=e.cacheEnabled)||r,cacheTTL:null!=(a=e.cacheTTL)?a:3e5}}getCacheKey(e,t){return`${e}:${JSON.stringify(t||{})}`}getFromCache(e){if(!this.config.cacheEnabled)return null;const t=this.cache.get(e);return t?Date.now()-t.timestamp>this.config.cacheTTL?(this.cache.delete(e),null):t.data:null}saveToCache(e,t){this.config.cacheEnabled&&this.cache.set(e,{data:t,timestamp:Date.now()})}fetchWithRetry(e,t){return v(this,arguments,function*(e,t,s=this.config.retries){const r=new AbortController,a=setTimeout(()=>r.abort(),this.config.timeout);try{const i=yield fetch(e,(o=((e,t)=>{for(var s in t||(t={}))S.call(t,s)&&E(e,s,t[s]);if(y)for(var s of y(t))b.call(t,s)&&E(e,s,t[s]);return e})({},t),n={signal:r.signal},p(o,f(n))));if(clearTimeout(a),i.ok)return i;if(i.status>=400&&i.status<500)throw new A(`API Error: ${i.status} ${i.statusText}`,i.status);if(s>0&&i.status>=500)return yield this.delay(1e3*(this.config.retries-s+1)),this.fetchWithRetry(e,t,s-1);throw new A(`API Error: ${i.status} ${i.statusText}`,i.status)}catch(i){if(clearTimeout(a),i instanceof A)throw i;if(i instanceof Error){if("AbortError"===i.name)throw new A("Request timeout",0);if(s>0)return yield this.delay(1e3*(this.config.retries-s+1)),this.fetchWithRetry(e,t,s-1)}throw new A("Network error",0)}var o,n})}delay(e){return new Promise(t=>setTimeout(t,e))}get(e,t){return v(this,null,function*(){const s=this.getCacheKey(e,t),r=this.getFromCache(s);if(null!==r)return r;const a=t?`?${new URLSearchParams(t).toString()}`:"",o=`${this.config.baseUrl}/api/${this.config.version}${e}${a}`,n=yield this.fetchWithRetry(o,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}),i=yield n.json();return this.saveToCache(s,i),i})}post(e,t){return v(this,null,function*(){const s=`${this.config.baseUrl}/api/${this.config.version}${e}`;return(yield this.fetchWithRetry(s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)})).json()})}clearCache(){this.cache.clear()}clearCacheForEndpoint(e){const t=[];for(const s of this.cache.keys())s.startsWith(e+":")&&t.push(s);t.forEach(e=>this.cache.delete(e))}}({baseUrl:o(),version:"v1",timeout:a.timeout,cacheEnabled:!0,cacheTTL:Number(void 0)||3e5}),L=Object.defineProperty,w=Object.getOwnPropertySymbols,_=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable,O=(e,t,s)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,P=(e,t)=>{for(var s in t||(t={}))_.call(t,s)&&O(e,s,t[s]);if(w)for(var s of w(t))D.call(t,s)&&O(e,s,t[s]);return e},I=(e,t,s)=>O(e,"symbol"!=typeof t?t+"":t,s),k=(e,t,s)=>new Promise((r,a)=>{var o=e=>{try{i(s.next(e))}catch(t){a(t)}},n=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,n);i((s=s.apply(e,t)).next())});const R=new class{constructor(e={}){I(this,"config"),I(this,"memoryCache"),I(this,"stats"),I(this,"compressionWorker"),I(this,"refreshQueue"),I(this,"prefetchQueue"),this.config=P({memoryMaxSize:52428800,memoryTTL:3e5,sessionStorageMaxSize:10485760,sessionStorageTTL:18e5,localStorageMaxSize:26214400,localStorageTTL:864e5,redisEnabled:!1,redisTTL:36e5,redisMaxSize:104857600,compressionEnabled:!0,backgroundRefreshEnabled:!0,prefetchEnabled:!0},e),this.memoryCache=new Map,this.refreshQueue=new Set,this.prefetchQueue=new Set,this.stats={memoryHits:0,memoryMisses:0,localStorageHits:0,localStorageMisses:0,sessionStorageHits:0,sessionStorageMisses:0,redisHits:0,redisMisses:0,totalRequests:0,hitRate:0,averageResponseTime:0,cacheEfficiency:0},this.initializeCompressionWorker(),this.startMaintenanceTasks()}initializeCompressionWorker(){if(this.config.compressionEnabled&&"undefined"!=typeof Worker)if(window.location.hostname.includes("github.io"))this.config.compressionEnabled=!1;else try{const e=new Blob(["\n        self.onmessage = function(e) {\n          const { action, data, id } = e.data;\n          \n          if (action === 'compress') {\n            try {\n              const compressed = LZString.compress(JSON.stringify(data));\n              self.postMessage({ id, result: compressed, success: true });\n            } catch (error) {\n              self.postMessage({ id, error: error.message, success: false });\n            }\n          } else if (action === 'decompress') {\n            try {\n              const decompressed = JSON.parse(LZString.decompress(data));\n              self.postMessage({ id, result: decompressed, success: true });\n            } catch (error) {\n              self.postMessage({ id, error: error.message, success: false });\n            }\n          }\n        };\n      "],{type:"application/javascript"});this.compressionWorker=new Worker(URL.createObjectURL(e))}catch(e){console.warn("Failed to initialize compression worker:",e),this.config.compressionEnabled=!1}}startMaintenanceTasks(){setInterval(()=>{this.cleanExpiredEntries()},3e5),setInterval(()=>{this.updateStatistics()},6e4),this.config.backgroundRefreshEnabled&&setInterval(()=>{this.processRefreshQueue()},3e4),this.config.prefetchEnabled&&setInterval(()=>{this.processPrefetchQueue()},1e4)}get(e,t){return k(this,null,function*(){const s=Date.now();this.stats.totalRequests++;try{const r=yield this.getFromMemory(e);if(null!==r)return this.stats.memoryHits++,this.updateAccessStats(e,"memory",Date.now()-s),r;this.stats.memoryMisses++;const a=yield this.getFromSessionStorage(e);if(null!==a)return this.stats.sessionStorageHits++,yield this.setInMemory(e,a,this.config.memoryTTL),this.updateAccessStats(e,"session",Date.now()-s),a;this.stats.sessionStorageMisses++;const o=yield this.getFromLocalStorage(e);if(null!==o)return this.stats.localStorageHits++,yield this.setInMemory(e,o,this.config.memoryTTL),yield this.setInSessionStorage(e,o,this.config.sessionStorageTTL),this.updateAccessStats(e,"local",Date.now()-s),o;if(this.stats.localStorageMisses++,this.config.redisEnabled){const t=yield this.getFromRedis(e);if(null!==t)return this.stats.redisHits++,yield this.setInMemory(e,t,this.config.memoryTTL),yield this.setInSessionStorage(e,t,this.config.sessionStorageTTL),yield this.setInLocalStorage(e,t,this.config.localStorageTTL),this.updateAccessStats(e,"redis",Date.now()-s),t;this.stats.redisMisses++}if(t){const s=yield t();return null!==s&&(yield this.set(e,s),this.scheduleBackgroundRefresh(e,t)),s}return null}catch(r){return console.error("Cache get error:",r),t?yield t():null}})}set(e,t,s){return k(this,null,function*(){try{const r=s||this.config.memoryTTL;yield Promise.all([this.setInMemory(e,t,r),this.setInSessionStorage(e,t,this.config.sessionStorageTTL),this.setInLocalStorage(e,t,this.config.localStorageTTL),...this.config.redisEnabled?[this.setInRedis(e,t,this.config.redisTTL)]:[]])}catch(r){console.error("Cache set error:",r)}})}delete(e){return k(this,null,function*(){try{yield Promise.all([this.deleteFromMemory(e),this.deleteFromSessionStorage(e),this.deleteFromLocalStorage(e),...this.config.redisEnabled?[this.deleteFromRedis(e)]:[]])}catch(t){console.error("Cache delete error:",t)}})}clear(){return k(this,null,function*(){try{yield Promise.all([this.clearMemory(),this.clearSessionStorage(),this.clearLocalStorage(),...this.config.redisEnabled?[this.clearRedis()]:[]]),this.refreshQueue.clear(),this.prefetchQueue.clear()}catch(e){console.error("Cache clear error:",e)}})}getFromMemory(e){return k(this,null,function*(){const t=this.memoryCache.get(e);return t?Date.now()>t.timestamp+t.ttl?(this.memoryCache.delete(e),null):(t.accessCount++,t.lastAccessed=Date.now(),t.data):null})}setInMemory(e,t,s){return k(this,null,function*(){const r=this.calculateDataSize(t);yield this.ensureMemorySpace(r);const a={data:t,timestamp:Date.now(),ttl:s,accessCount:1,lastAccessed:Date.now(),size:r,key:e};this.memoryCache.set(e,a)})}deleteFromMemory(e){return k(this,null,function*(){this.memoryCache.delete(e)})}clearMemory(){return k(this,null,function*(){this.memoryCache.clear()})}getFromSessionStorage(e){return k(this,null,function*(){try{const t=sessionStorage.getItem(`mlc_${e}`);if(!t)return null;const s=JSON.parse(t);return Date.now()>s.timestamp+s.ttl?(sessionStorage.removeItem(`mlc_${e}`),null):s.compressed?yield this.decompress(s.data):s.data}catch(t){return console.warn("Session storage get error:",t),null}})}setInSessionStorage(e,t,s){return k(this,null,function*(){try{const r=this.config.compressionEnabled?yield this.compress(t):t,a={data:r,timestamp:Date.now(),ttl:s,accessCount:1,lastAccessed:Date.now(),compressed:this.config.compressionEnabled,size:this.calculateDataSize(r),key:e};sessionStorage.setItem(`mlc_${e}`,JSON.stringify(a))}catch(r){console.warn("Session storage set error:",r)}})}deleteFromSessionStorage(e){return k(this,null,function*(){try{sessionStorage.removeItem(`mlc_${e}`)}catch(t){console.warn("Session storage delete error:",t)}})}clearSessionStorage(){return k(this,null,function*(){try{Object.keys(sessionStorage).forEach(e=>{e.startsWith("mlc_")&&sessionStorage.removeItem(e)})}catch(e){console.warn("Session storage clear error:",e)}})}getFromLocalStorage(e){return k(this,null,function*(){try{const t=localStorage.getItem(`mlc_${e}`);if(!t)return null;const s=JSON.parse(t);return Date.now()>s.timestamp+s.ttl?(localStorage.removeItem(`mlc_${e}`),null):s.compressed?yield this.decompress(s.data):s.data}catch(t){return console.warn("Local storage get error:",t),null}})}setInLocalStorage(e,t,s){return k(this,null,function*(){try{const r=this.config.compressionEnabled?yield this.compress(t):t,a={data:r,timestamp:Date.now(),ttl:s,accessCount:1,lastAccessed:Date.now(),compressed:this.config.compressionEnabled,size:this.calculateDataSize(r),key:e};localStorage.setItem(`mlc_${e}`,JSON.stringify(a))}catch(r){console.warn("Local storage set error:",r)}})}deleteFromLocalStorage(e){return k(this,null,function*(){try{localStorage.removeItem(`mlc_${e}`)}catch(t){console.warn("Local storage delete error:",t)}})}clearLocalStorage(){return k(this,null,function*(){try{Object.keys(localStorage).forEach(e=>{e.startsWith("mlc_")&&localStorage.removeItem(e)})}catch(e){console.warn("Local storage clear error:",e)}})}getFromRedis(e){return k(this,null,function*(){return null})}setInRedis(e,t,s){return k(this,null,function*(){})}deleteFromRedis(e){return k(this,null,function*(){})}clearRedis(){return k(this,null,function*(){})}calculateDataSize(e){return new Blob([JSON.stringify(e)]).size}ensureMemorySpace(e){return k(this,null,function*(){if(Array.from(this.memoryCache.values()).reduce((e,t)=>e+t.size,0)+e<=this.config.memoryMaxSize)return;const t=Array.from(this.memoryCache.entries()).sort(([,e],[,t])=>e.lastAccessed-t.lastAccessed);let s=0;for(const[r,a]of t)if(this.memoryCache.delete(r),s+=a.size,s>=e)break})}compress(e){return k(this,null,function*(){return this.config.compressionEnabled&&this.compressionWorker?new Promise(t=>{const s=Math.random().toString(36),r=a=>{a.data.id===s&&(this.compressionWorker.removeEventListener("message",r),t(a.data.success?a.data.result:e))};this.compressionWorker.addEventListener("message",r),this.compressionWorker.postMessage({action:"compress",data:e,id:s}),setTimeout(()=>t(e),1e3)}):e})}decompress(e){return k(this,null,function*(){return this.config.compressionEnabled&&this.compressionWorker?new Promise(t=>{const s=Math.random().toString(36),r=a=>{a.data.id===s&&(this.compressionWorker.removeEventListener("message",r),t(a.data.success?a.data.result:e))};this.compressionWorker.addEventListener("message",r),this.compressionWorker.postMessage({action:"decompress",data:e,id:s}),setTimeout(()=>t(e),1e3)}):e})}cleanExpiredEntries(){const e=Date.now();for(const[t,s]of this.memoryCache.entries())e>s.timestamp+s.ttl&&this.memoryCache.delete(t)}updateStatistics(){const e=this.stats.memoryHits+this.stats.sessionStorageHits+this.stats.localStorageHits+this.stats.redisHits;this.stats.hitRate=this.stats.totalRequests>0?e/this.stats.totalRequests*100:0,this.stats.cacheEfficiency=this.calculateCacheEfficiency()}calculateCacheEfficiency(){const e=4*this.stats.memoryHits+3*this.stats.sessionStorageHits+2*this.stats.localStorageHits+1*this.stats.redisHits,t=4*this.stats.totalRequests;return t>0?e/t*100:0}updateAccessStats(e,t,s){this.stats.averageResponseTime=.9*this.stats.averageResponseTime+.1*s}scheduleBackgroundRefresh(e,t){this.config.backgroundRefreshEnabled&&this.refreshQueue.add(e)}processRefreshQueue(){return k(this,null,function*(){const e=Array.from(this.refreshQueue).slice(0,3);this.refreshQueue=new Set(Array.from(this.refreshQueue).slice(3));for(const t of e);})}processPrefetchQueue(){return k(this,null,function*(){const e=Array.from(this.prefetchQueue).slice(0,2);this.prefetchQueue=new Set(Array.from(this.prefetchQueue).slice(2));for(const t of e);})}getStats(){return this.updateStatistics(),P({},this.stats)}getCacheSizes(){return{memory:Array.from(this.memoryCache.values()).reduce((e,t)=>e+t.size,0),session:0,local:0,redis:0}}dispose(){this.compressionWorker&&this.compressionWorker.terminate(),this.memoryCache.clear(),this.refreshQueue.clear(),this.prefetchQueue.clear()}}({compressionEnabled:!0,backgroundRefreshEnabled:!0,prefetchEnabled:!0});var j=Object.defineProperty,x=Object.defineProperties,M=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable,V=(e,t,s)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,U=(e,t,s)=>V(e,"symbol"!=typeof t?t+"":t,s),z=(e,t,s)=>new Promise((r,a)=>{var o=e=>{try{i(s.next(e))}catch(t){a(t)}},n=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,n);i((s=s.apply(e,t)).next())});const H=class e{constructor(){U(this,"csvDataCache",null),U(this,"requestCache",new Map)}static getInstance(){return e.instance||(e.instance=new e),e.instance}testBackendConnectivity(){return z(this,null,function*(){try{const e=new AbortController,t=setTimeout(()=>e.abort(),5e3),s=o(),r=yield fetch(`${s}/health`,{method:"GET",signal:e.signal,headers:{Accept:"application/json"}});return clearTimeout(t),r.ok?{available:!0}:{available:!1,reason:`HTTP ${r.status}`}}catch(e){return console.log(`Backend connectivity check failed: ${e instanceof Error?e.message:"Unknown error"}`),{available:!1,reason:"Connection failed"}}})}getLocalCsvData(){return z(this,null,function*(){const t=e.CACHE_KEYS.CSV_DATA,s=yield R.get(t);if(s)return console.log("📦 Using multi-layer cached CSV data"),s;if(this.csvDataCache&&this.csvDataCache.length>0){console.log("Using in-memory cached real CSV data.");const e={documents:this.csvDataCache,usingFallback:!0};return yield R.set(t,e,864e5),e}try{console.log("Attempting to load real CSV legislative data...");const e=yield h();if(e&&Array.isArray(e)&&e.length>0){console.log(`Loaded ${e.length} real documents from CSV`),this.csvDataCache=e;const s={documents:e,usingFallback:!0};return yield R.set(t,s,864e5),s}throw new Error("CSV file was loaded but contained no documents or invalid data.")}catch(r){throw console.error("Critical error: Failed to load or parse real CSV data.",r),console.error("🚨 NO MOCK FALLBACK: Academic integrity requires real data sources only"),new Error(`Cannot load legislative data: ${r instanceof Error?r.message:"Unknown CSV error"}. Real data source required.`)}})}fetchDocuments(t){return z(this,null,function*(){const s=JSON.stringify(t||{}),r=`${e.CACHE_KEYS.DOCUMENTS}_${s}`,a=yield R.get(r,()=>z(this,null,function*(){return console.log("🔄 Cache miss - fetching fresh data"),yield this._performFetch(t)}));if(a)return console.log("🎯 Cache hit - returning cached documents"),a;if(this.requestCache.has(s))return console.log("⚡ Request deduped: Using existing pending request"),this.requestCache.get(s);const o=this._performFetch(t);return this.requestCache.set(s,o),console.log(`📊 Active requests: ${this.requestCache.size}`),o.then(e=>z(this,null,function*(){yield R.set(r,e,6e5)})).finally(()=>{this.requestCache.delete(s),console.log(`🧹 Cache cleanup - Active requests: ${this.requestCache.size}`)}),o})}_performFetch(e){return z(this,null,function*(){var t,s,r;try{if(console.log("🔬 Connecting to LexML Enhanced Research Engine..."),(yield this.testBackendConnectivity()).available){console.log("✅ Backend connectivity confirmed, proceeding with enhanced search...");const a=(r=((e,t)=>{for(var s in t||(t={}))N.call(t,s)&&V(e,s,t[s]);if($)for(var s of $(t))F.call(t,s)&&V(e,s,t[s]);return e})({},this.buildQueryParams(e)),x(r,M({sources:"lexml,camara,senado,planalto"})));console.log("🔍 API Search Parameters:",a);const o=yield T.get("/search",a);console.log("📡 API Response Analysis:"),console.log("  - Query:",null==o?void 0:o.query),console.log("  - Total Count:",null==o?void 0:o.total_count),console.log("  - Results Length:",(null==(t=null==o?void 0:o.results)?void 0:t.length)||0),console.log("  - Sources:",null==o?void 0:o.sources),console.log("  - Enhanced Search:",null==o?void 0:o.enhanced_search),console.log("  - Filters Applied:",null==o?void 0:o.filters),console.log("  - Metadata:",null==o?void 0:o.metadata),0===(null==o?void 0:o.total_count)&&(console.warn("🚨 Backend API found 0 results for query:",null==o?void 0:o.query),console.log("🔧 This suggests the backend search needs investigation"));const n=this.transformSearchResponse(o);if(0===n.length){console.warn("🔄 Enhanced API returned no results, falling back to embedded real data");const t=yield this.getLocalCsvData();return{documents:this.filterLocalData(t.documents,e),usingFallback:t.usingFallback}}return(null==(s=o.metadata)?void 0:s.vocabulary_expansion)&&console.log(`📚 Vocabulary enhanced search: '${o.metadata.vocabulary_expansion.original_term}' → ${o.metadata.vocabulary_expansion.expansion_count} terms`),console.log(`✅ Successfully fetched ${n.length} documents from LexML Enhanced API`),{documents:n,usingFallback:!1}}{console.warn("⚠️ Backend not available, using embedded real data immediately");const t=yield this.getLocalCsvData();return{documents:this.filterLocalData(t.documents,e),usingFallback:t.usingFallback}}}catch(a){console.warn("⚠️ Enhanced API fetch failed, attempting fallback to embedded real data:",a);try{const t=yield this.getLocalCsvData();return{documents:this.filterLocalData(t.documents,e),usingFallback:t.usingFallback}}catch(o){throw console.error("❌ Both Enhanced API and embedded data sources failed:",{apiError:a,csvError:o}),new Error("Unable to load legislative data from any real source (Enhanced API or embedded data). Please check data availability.")}}})}fetchDocumentById(t){return z(this,null,function*(){const s=`${e.CACHE_KEYS.DOCUMENT_BY_ID}_${t}`,r=yield R.get(s);if(r)return console.log(`🎯 Cache hit for document ID: ${t}`),r;const a=(yield this.fetchDocuments()).documents.find(e=>e.id===t)||null;return a&&(yield R.set(s,a,18e5)),a})}searchDocuments(t){return z(this,null,function*(){const s=`${e.CACHE_KEYS.SEARCH_RESULTS}_${t.toLowerCase()}`,r=yield R.get(s);if(r)return console.log(`🎯 Cache hit for search term: ${t}`),r;const a=yield this.fetchDocuments(),o=t.toLowerCase(),n=a.documents.filter(e=>e.title.toLowerCase().includes(o)||e.summary.toLowerCase().includes(o)||e.keywords&&e.keywords.some(e=>e.toLowerCase().includes(o)));return yield R.set(s,n,9e5),n})}filterLocalData(e,t){return t?e.filter(e=>!(t.searchTerm&&!e.title.toLowerCase().includes(t.searchTerm.toLowerCase())&&!e.summary.toLowerCase().includes(t.searchTerm.toLowerCase())&&!e.keywords.some(e=>e.toLowerCase().includes(t.searchTerm.toLowerCase()))||t.documentTypes.length>0&&!t.documentTypes.includes(e.type)||t.states.length>0&&e.state&&!t.states.includes(e.state)||t.municipalities.length>0&&e.municipality&&!t.municipalities.includes(e.municipality)||t.chambers.length>0&&e.chamber&&!t.chambers.includes(e.chamber)||t.dateFrom&&new Date(e.date)<t.dateFrom||t.dateTo&&new Date(e.date)>t.dateTo)):e}buildQueryParams(e){const t={};return t.q=(null==e?void 0:e.searchTerm)||"transporte",(null==e?void 0:e.states)&&e.states.length>0&&(t.states=e.states.join(",")),(null==e?void 0:e.dateFrom)&&(t.start_date=this.formatDate(e.dateFrom)),(null==e?void 0:e.dateTo)&&(t.end_date=this.formatDate(e.dateTo)),t.sources="CAMARA,SENADO,PLANALTO",t}formatDate(e){return e.toISOString().split("T")[0]}transformSearchResponse(e){return e.results&&Array.isArray(e.results)?e.results.map(e=>this.transformProposition(e)):[]}transformProposition(e){var t,s;let r="";return e.authors&&Array.isArray(e.authors)&&e.authors.length>0&&(r=e.authors[0].state||""),{id:e.id,title:e.title,summary:e.summary||"",type:{PL:"projeto_lei",PLP:"projeto_lei",PEC:"projeto_lei",MPV:"medida_provisoria",PLV:"projeto_lei",PDL:"decreto",PRC:"resolucao",DECRETO:"decreto",PORTARIA:"portaria",RESOLUCAO:"resolucao",INSTRUCAO_NORMATIVA:"instrucao_normativa",LEI:"lei"}[e.type]||"projeto_lei",date:e.publication_date||e.date||(new Date).toISOString(),keywords:e.keywords||[],state:r,municipality:e.municipality||"",url:e.url||"",status:{ACTIVE:"em_tramitacao",APPROVED:"aprovado",REJECTED:"rejeitado",ARCHIVED:"arquivado",WITHDRAWN:"arquivado",PUBLISHED:"sancionado"}[e.status]||"em_tramitacao",author:(null==(s=null==(t=e.authors)?void 0:t[0])?void 0:s.name)||"",chamber:"CAMARA"===e.source?"Câmara dos Deputados":"SENADO"===e.source?"Senado Federal":"",number:e.number,source:e.source,citation:e.citation}}fetchCollectionStatus(){return z(this,null,function*(){const t=e.CACHE_KEYS.COLLECTION_STATUS,s=yield R.get(t);if(s)return console.log("🎯 Cache hit for collection status"),s;try{const e=yield T.get("/collections/recent"),s=this.transformCollectionLogs(e);return yield R.set(t,s,3e5),s}catch(r){return console.error("Failed to fetch collection status:",r),[]}})}fetchLatestCollection(){return z(this,null,function*(){const t=e.CACHE_KEYS.LATEST_COLLECTION,s=yield R.get(t);if(null!==s)return console.log("🎯 Cache hit for latest collection"),s;try{const e=yield T.get("/collections/latest");let s=null;return e&&e.id&&(s=this.transformCollectionLog(e)),yield R.set(t,s,18e4),s}catch(r){return console.error("Failed to fetch latest collection:",r),null}})}transformCollectionLogs(e){return e&&Array.isArray(e)?e.map(e=>this.transformCollectionLog(e)):[]}transformCollectionLog(e){return{id:e.id,searchTermId:e.search_term_id,searchTerm:e.search_term,status:e.status,recordsCollected:e.records_collected||0,recordsNew:e.records_new||0,recordsUpdated:e.records_updated||0,recordsSkipped:e.records_skipped||0,executionTimeMs:e.execution_time_ms||0,errorMessage:e.error_message,startedAt:e.started_at,completedAt:e.completed_at,sourcesUsed:e.sources_used||[]}}invalidateCache(e){return z(this,null,function*(){switch(e){case"documents":case"search":case"collections":break;default:return yield R.clear(),void console.log("🧹 All caches cleared")}console.log(`🧹 Invalidating cache for type: ${e}`),yield R.clear()})}getCacheStats(){return z(this,null,function*(){return R.getStats()})}getCacheSizes(){return z(this,null,function*(){return R.getCacheSizes()})}forceRefreshDocuments(t){return z(this,null,function*(){const s=JSON.stringify(t||{}),r=`${e.CACHE_KEYS.DOCUMENTS}_${s}`;return yield R.delete(r),this.fetchDocuments(t)})}};U(H,"instance"),U(H,"CACHE_KEYS",{DOCUMENTS:"legislative_docs",SEARCH_RESULTS:"search_results",DOCUMENT_BY_ID:"document_id",COLLECTION_STATUS:"collection_status",LATEST_COLLECTION:"latest_collection",CSV_DATA:"csv_data"});const q=H.getInstance();var B=Object.defineProperty,W=Object.defineProperties,G=Object.getOwnPropertyDescriptors,Q=Object.getOwnPropertySymbols,J=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,K=(e,t,s)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,X=(e,t)=>{for(var s in t||(t={}))J.call(t,s)&&K(e,s,t[s]);if(Q)for(var s of Q(t))Y.call(t,s)&&K(e,s,t[s]);return e},Z=(e,t)=>W(e,G(t)),ee=(e,t,s)=>new Promise((r,a)=>{var o=e=>{try{i(s.next(e))}catch(t){a(t)}},n=e=>{try{i(s.throw(e))}catch(t){a(t)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,n);i((s=s.apply(e,t)).next())});const te=r.lazy(()=>e(()=>import("./OptimizedMap-CAu2bEk7.js"),__vite__mapDeps([0,1,2,3,4,5]))),se=r.lazy(()=>e(()=>import("./TabbedSidebar-ip4jn3k1.js"),__vite__mapDeps([6,1,2,3,4,7]))),re=r.lazy(()=>e(()=>import("./ExportPanel-DDJjEkzN.js"),__vite__mapDeps([8,1,2,3,4,9,10,11]))),ae=r.lazy(()=>e(()=>import("./AIResearchAssistant-DCZa6LRP.js"),__vite__mapDeps([12,1,2,3,4,9]))),oe=r.lazy(()=>e(()=>import("./DocumentValidationPanel-C707-CDs.js"),__vite__mapDeps([13,1,2,3,4,9]))),ne={sidebarOpen:!0,exportPanelOpen:!1,aiAssistantOpen:!1,validationPanelOpen:!1,selectedState:void 0,selectedMunicipality:void 0,filters:{searchTerm:"",documentTypes:[],states:[],municipalities:[],chambers:[],keywords:[],dateFrom:void 0,dateTo:void 0},selectedDocuments:[]},ie=(e,t)=>{switch(t.type){case"TOGGLE_SIDEBAR":return Z(X({},e),{sidebarOpen:!e.sidebarOpen});case"SET_SIDEBAR_OPEN":return Z(X({},e),{sidebarOpen:t.payload});case"TOGGLE_EXPORT_PANEL":return Z(X({},e),{exportPanelOpen:!e.exportPanelOpen});case"TOGGLE_AI_ASSISTANT":return Z(X({},e),{aiAssistantOpen:!e.aiAssistantOpen});case"TOGGLE_VALIDATION_PANEL":return Z(X({},e),{validationPanelOpen:!e.validationPanelOpen});case"SELECT_STATE":return Z(X({},e),{selectedState:t.payload,selectedMunicipality:void 0});case"SELECT_MUNICIPALITY":return Z(X({},e),{selectedMunicipality:t.payload});case"CLEAR_SELECTION":return Z(X({},e),{selectedState:void 0,selectedMunicipality:void 0});case"UPDATE_FILTERS":return Z(X({},e),{filters:t.payload});case"SET_SELECTED_DOCUMENTS":return Z(X({},e),{selectedDocuments:t.payload});default:return e}};const le=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const[e,a]=r.useReducer(ie,ne),[o,n]=r.useState([]),[i,l]=r.useState(!0),[c,u]=r.useState(null),[d,h]=r.useState(!1),{sidebarOpen:m,exportPanelOpen:g,aiAssistantOpen:p,validationPanelOpen:f,selectedState:y,selectedMunicipality:S,filters:b,selectedDocuments:E}=e,C=r.useRef(null),v=r.useRef(null),A=r.useRef(null);((e,t)=>{const s=r.useRef(e),a=r.useRef(t);r.useEffect(()=>{s.current=e,a.current=t});const o=r.useCallback(e=>{var t,r;switch(e.key){case"Escape":null==(t=s.current)||t.call(s);break;case"Enter":case" ":e.preventDefault(),null==(r=a.current)||r.call(a)}},[]);r.useEffect(()=>(document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)),[o])})(),r.useEffect(()=>(ee(null,null,function*(){A.current&&A.current.abort(),v.current&&clearTimeout(v.current),v.current=setTimeout(()=>ee(null,null,function*(){console.log("🎯 API Request: Debounced search triggered",{searchTerm:b.searchTerm}),l(!0),u(null);try{A.current=new AbortController;const{documents:e,usingFallback:t}=yield q.fetchDocuments(b);0===e.length&&t&&u("Could not load from API or CSV. Please check data sources."),n(e),h(t),console.log("📊 Request completed",{documentsFound:e.length,usingFallback:t})}catch(e){if(e instanceof Error&&"AbortError"===e.name)return void console.log("⚡ Request cancelled - user continued typing");const t=e instanceof Error?e.message:"An unknown error occurred";u(t),console.error("Error loading documents:",e)}finally{l(!1)}}),500)}),()=>{v.current&&clearTimeout(v.current),A.current&&A.current.abort()}),[b]);const T=r.useCallback((e,t)=>{a({type:"state"===e?"SELECT_STATE":"SELECT_MUNICIPALITY",payload:t})},[]),L=r.useCallback(()=>a({type:"CLEAR_SELECTION"}),[]),w=r.useCallback(e=>a({type:"UPDATE_FILTERS",payload:e}),[]),_=r.useCallback(()=>a({type:"TOGGLE_SIDEBAR"}),[]),D=r.useCallback(()=>a({type:"TOGGLE_EXPORT_PANEL"}),[]),O=r.useCallback(()=>a({type:"TOGGLE_AI_ASSISTANT"}),[]),P=r.useCallback(()=>a({type:"TOGGLE_VALIDATION_PANEL"}),[]),I=r.useMemo(()=>o&&Array.isArray(o)?o.filter(e=>!(!e||y&&e.state!==y||S&&e.municipality!==S)):[],[o,y,S]),k=r.useMemo(()=>I&&Array.isArray(I)?[...new Set(I.map(e=>null==e?void 0:e.state).filter(e=>Boolean(e)))]:[],[I]);return t.jsxs("div",{className:"dashboard",children:[t.jsx(r.Suspense,{fallback:t.jsx(s,{message:"Loading sidebar..."}),children:t.jsx(se,{isOpen:m,onToggle:_,filters:b,onFiltersChange:w,documents:o||[],selectedState:y,onClearSelection:L})}),t.jsxs("main",{id:"main-content",ref:C,className:"main-content",tabIndex:-1,children:[t.jsxs("header",{className:"toolbar",children:[t.jsxs("div",{className:"toolbar-left",children:[t.jsx("h1",{children:"Brazilian Transport Legislation Monitor"}),t.jsx("p",{className:"toolbar-subtitle",children:"Academic research platform for transport legislation analysis"})]}),t.jsxs("div",{className:"toolbar-right",children:[i?t.jsx(s,{message:"Loading..."}):t.jsxs("div",{className:"stats","aria-live":"polite",children:[t.jsxs("span",{className:"stat-item",children:["📄 ",I.length," Docs"]}),t.jsxs("span",{className:"stat-item",children:["🗺️ ",k.length," States"]})]}),t.jsx("button",{className:"ai-btn",onClick:O,"aria-controls":"ai-assistant","aria-expanded":p,children:"🤖 AI Assistant"}),t.jsx("button",{className:"validation-btn",onClick:P,"aria-controls":"validation-panel","aria-expanded":f,children:"🛡️ Validate"}),t.jsx("button",{className:"export-btn",onClick:D,"aria-controls":"export-panel","aria-expanded":g,children:"📊 Export"})]})]}),d&&t.jsxs("div",{className:"fallback-warning-banner",role:"alert",children:[t.jsx("strong",{children:"Warning:"})," Using local CSV data. API connection may have failed."]}),c&&!i&&t.jsxs("div",{className:"dashboard-error",role:"alert",children:[t.jsx("h2",{children:"Error Loading Data"}),t.jsx("p",{children:c}),t.jsx("button",{onClick:()=>window.location.reload(),children:"Try Again"})]}),t.jsxs("section",{className:"map-wrapper","aria-labelledby":"map-heading",children:[t.jsx("h2",{id:"map-heading",className:"sr-only",children:"Interactive map"}),t.jsx(r.Suspense,{fallback:t.jsx(s,{message:"Loading map..."}),children:t.jsx(te,{selectedState:y,selectedMunicipality:S,documents:I||[],onLocationClick:T,highlightedLocations:k||[]})})]}),(y||S)&&t.jsx("aside",{className:"info-panel",role:"complementary","aria-labelledby":"location-info-heading",children:t.jsxs("div",{className:"info-content",children:[t.jsxs("h3",{id:"location-info-heading",children:[y&&!S&&`State: ${y}`,S&&`Municipality: ${S}, ${y}`]}),t.jsxs("p",{children:[I.length," documents found."]}),t.jsx("button",{onClick:L,className:"close-info","aria-label":"Clear selection",children:"✕"})]})})]}),t.jsx(r.Suspense,{fallback:t.jsx(s,{message:"Loading export panel..."}),children:t.jsx(re,{id:"export-panel",isOpen:g,onClose:D,documents:I||[]})}),p&&t.jsx(r.Suspense,{fallback:t.jsx(s,{message:"Loading AI assistant..."}),children:t.jsx(ae,{selectedDocuments:E,onDocumentAnalyzed:e=>console.log("Document analyzed:",e),className:"ai-assistant-panel"})}),f&&t.jsx(r.Suspense,{fallback:t.jsx(s,{message:"Loading validation panel..."}),children:t.jsx(oe,{documents:E,onValidationComplete:e=>console.log("Validation complete:",e),className:"validation-panel"})})]})}},Symbol.toStringTag,{value:"Module"}));export{le as D,T as a};
