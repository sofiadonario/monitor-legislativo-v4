import{j as s}from"./index-DshiUUTS.js";import{r as e}from"./leaflet-vendor-CuwtxqHJ.js";import{l as a}from"./Dashboard-D8dtKLwJ.js";import"./react-vendor-DFJYf2oa.js";import"./SkeletonLoader-DpXMiago.js";const t=({className:t="",compact:l=!1})=>{const[c,r]=e.useState(null),[n,i]=e.useState(!0),[d,o]=e.useState(null),[u]=e.useState(3e4);e.useEffect(()=>{const s=()=>{return s=function*(){try{i(!0);const s=yield a.fetchLatestCollection();r(s),o(null)}catch(s){o("Failed to fetch collection status"),console.error("Collection status error:",s)}finally{i(!1)}},new Promise((e,a)=>{var t=e=>{try{c(s.next(e))}catch(t){a(t)}},l=e=>{try{c(s.throw(e))}catch(t){a(t)}},c=s=>s.done?e(s.value):Promise.resolve(s.value).then(t,l);c((s=s.apply(null,null)).next())});var s};s();const e=setInterval(s,u);return()=>clearInterval(e)},[u]);const m=s=>{switch(s){case"completed":return"#28a745";case"running":return"#17a2b8";case"pending":return"#ffc107";case"failed":return"#dc3545";default:return"#6c757d"}},h=s=>{switch(s){case"completed":return"✓";case"running":return"⟳";case"pending":return"⏳";case"failed":return"✗";default:return"?"}},j=s=>{const e=new Date(s),a=(new Date).getTime()-e.getTime(),t=Math.floor(a/6e4);return t<1?"just now":t<60?`${t}m ago`:t<1440?`${Math.floor(t/60)}h ago`:e.toLocaleDateString()};return n&&!c?s.jsx("div",{className:`collection-status ${t}`,children:s.jsx("div",{className:"status-loading",children:"Loading collection status..."})}):d?s.jsx("div",{className:`collection-status ${t}`,children:s.jsx("div",{className:"status-error",children:d})}):c?l?s.jsxs("div",{className:`collection-status collection-status-compact ${t}`,children:[s.jsx("span",{className:"status-indicator",style:{backgroundColor:m(c.status)},title:`Status: ${c.status}`,children:h(c.status)}),s.jsx("span",{className:"status-text",children:"running"===c.status?"Collecting...":`Last: ${j(c.startedAt)}`}),c.recordsCollected>0&&s.jsxs("span",{className:"status-count",children:[c.recordsCollected," docs"]})]}):s.jsxs("div",{className:`collection-status ${t}`,children:[s.jsxs("div",{className:"status-header",children:[s.jsx("h3",{children:"Data Collection Status"}),s.jsxs("span",{className:"status-badge",style:{backgroundColor:m(c.status)},children:[h(c.status)," ",c.status]})]}),s.jsxs("div",{className:"status-details",children:[s.jsxs("div",{className:"status-row",children:[s.jsx("span",{className:"status-label",children:"Search Term:"}),s.jsx("span",{className:"status-value",children:c.searchTerm})]}),s.jsxs("div",{className:"status-row",children:[s.jsx("span",{className:"status-label",children:"Started:"}),s.jsx("span",{className:"status-value",children:j(c.startedAt)})]}),c.completedAt&&s.jsxs("div",{className:"status-row",children:[s.jsx("span",{className:"status-label",children:"Duration:"}),s.jsx("span",{className:"status-value",children:(x=c.executionTimeMs,x<1e3?`${x}ms`:x<6e4?`${(x/1e3).toFixed(1)}s`:`${(x/6e4).toFixed(1)}min`)})]}),s.jsxs("div",{className:"status-metrics",children:[s.jsxs("div",{className:"metric",children:[s.jsx("span",{className:"metric-value",children:c.recordsCollected}),s.jsx("span",{className:"metric-label",children:"Total"})]}),s.jsxs("div",{className:"metric",children:[s.jsx("span",{className:"metric-value",children:c.recordsNew}),s.jsx("span",{className:"metric-label",children:"New"})]}),s.jsxs("div",{className:"metric",children:[s.jsx("span",{className:"metric-value",children:c.recordsUpdated}),s.jsx("span",{className:"metric-label",children:"Updated"})]}),s.jsxs("div",{className:"metric",children:[s.jsx("span",{className:"metric-value",children:c.recordsSkipped}),s.jsx("span",{className:"metric-label",children:"Skipped"})]})]}),c.sourcesUsed.length>0&&s.jsxs("div",{className:"status-row",children:[s.jsx("span",{className:"status-label",children:"Sources:"}),s.jsx("span",{className:"status-value",children:c.sourcesUsed.join(", ")})]}),c.errorMessage&&s.jsxs("div",{className:"status-error-message",children:[s.jsx("strong",{children:"Error:"})," ",c.errorMessage]})]})]}):s.jsx("div",{className:`collection-status ${t}`,children:s.jsx("div",{className:"status-empty",children:"No collection data available"})});var x};export{t as CollectionStatus};
