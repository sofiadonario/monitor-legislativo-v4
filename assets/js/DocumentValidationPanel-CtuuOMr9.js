import{j as e,L as s}from"./index-DZU-AcPW.js";import{r as a}from"./leaflet-vendor-CuwtxqHJ.js";import{a as t}from"./Dashboard-Bc4D4KLR.js";import{a as l}from"./api-BEIyjD6w.js";import"./react-vendor-DFJYf2oa.js";var i=(e,s,a)=>new Promise((t,l)=>{var i=e=>{try{r(a.next(e))}catch(s){l(s)}},n=e=>{try{r(a.throw(e))}catch(s){l(s)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,n);r((a=a.apply(e,s)).next())});const n=new class{validateDocument(e){return i(this,null,function*(){return t.post(l.validation.document,e)})}validateDocumentsBatch(e){return i(this,null,function*(){return t.post(l.validation.batch,e)})}validateURN(e){return i(this,null,function*(){return t.post(l.validation.urn,e)})}getQualityReport(e){return i(this,null,function*(){const s=e?{document_ids:e}:void 0;return t.get(l.validation.qualityReport,s)})}getValidationRules(){return i(this,null,function*(){return t.get(l.validation.rules)})}getValidationStatistics(){return i(this,null,function*(){return t.get(l.validation.statistics)})}checkHealth(){return i(this,null,function*(){return t.get(l.validation.health)})}validateWithRecommendations(e){return i(this,null,function*(){return this.validateDocument({document:e,include_recommendations:!0})})}getQualityAssessment(e){return i(this,null,function*(){const s=yield this.validateWithRecommendations(e);let a;const t=s.quality_metrics.overall_score;a=t>=.9?"excellent":t>=.7?"good":t>=.5?"fair":"poor";const l=s.validation_rules.filter(e=>!e.passed&&"warning"===e.level).map(e=>e.rule_name);return{validation:s,qualityLevel:a,improvementAreas:l}})}validateBrazilianLegislativeURN(e){return i(this,null,function*(){const s=yield this.validateURN({urn:e});let a,t;if(e.includes("urn:lex:br:")){const s=e.split(":");s.length>=5&&(t=s[3],a=s[4])}const l=[];return s.is_valid||(l.push("Ensure URN follows format: urn:lex:br:authority:type:date:number"),e.startsWith("urn:lex:br:")||l.push('URN must start with "urn:lex:br:" for Brazilian documents')),{validation:s,documentType:a,authority:t,suggestions:l}})}validateBatchWithProgress(e,s){return i(this,null,function*(){const a=[];let t=0;for(let c=0;c<e.length;c+=10){const l=e.slice(c,c+10),i=yield this.validateDocumentsBatch({documents:l,include_recommendations:!0});a.push(...i.validation_results),t+=l.length,s&&s(t,e.length)}const l=a.filter(e=>e.is_valid).length,i=a.length-l,n=a.reduce((e,s)=>e+s.processing_time_ms,0)/a.length,r=a.reduce((e,s)=>e+s.quality_metrics.overall_score,0)/a.length;return{total_documents:a.length,valid_documents:l,invalid_documents:i,validation_results:a,processing_summary:{average_processing_time_ms:n,average_quality_score:r,total_errors:a.reduce((e,s)=>e+s.quality_metrics.errors,0),total_warnings:a.reduce((e,s)=>e+s.quality_metrics.warnings,0)}}})}getValidationInsights(){return i(this,null,function*(){const[e,s,a]=yield Promise.all([this.getValidationRules(),this.getQualityReport(),this.getValidationStatistics()]);return{rules:e.validation_rules,qualityReport:s,statistics:a.statistics,recommendations:["Focus on improving metadata completeness for better document discoverability","Ensure URN formats follow Brazilian legislative standards","Add transport-specific metadata for domain relevance","Validate date formats for consistency","Include proper keywords for enhanced searchability"]}})}};var r=(e,s,a)=>new Promise((t,l)=>{var i=e=>{try{r(a.next(e))}catch(s){l(s)}},n=e=>{try{r(a.throw(e))}catch(s){l(s)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(i,n);r((a=a.apply(e,s)).next())}),c=({documents:t=[],onValidationComplete:l,className:i=""})=>{const[c,d]=a.useState([]),[o,m]=a.useState(!1),[u,h]=a.useState(null),[v,x]=a.useState(null),[p,j]=a.useState({processed:0,total:0}),[g,N]=a.useState(null);a.useEffect(()=>{f()},[]),a.useEffect(()=>{t.length>0&&t.length<=10&&y()},[t]);const f=()=>r(null,null,function*(){try{const e=yield n.checkHealth();N(e)}catch(e){console.warn("Could not check validation service health:",e)}}),y=()=>r(null,null,function*(){if(0!==t.length){m(!0),h(null),j({processed:0,total:t.length});try{const e=yield n.validateBatchWithProgress(t,(e,s)=>{j({processed:e,total:s})});d(e.validation_results),l&&l(e.validation_results)}catch(e){const s=e instanceof Error?e.message:"Validation failed";h(s)}finally{m(!1),j({processed:0,total:0})}}}),_=e=>e>=.9?"excellent":e>=.7?"good":e>=.5?"fair":"poor",b=e=>e>=.9?"#22c55e":e>=.7?"#3b82f6":e>=.5?"#f59e0b":"#ef4444";return e.jsxs("div",{className:`document-validation-panel ${i}`,children:[e.jsxs("div",{className:"panel-header",children:[e.jsx("h3",{children:"ðŸ›¡ï¸ Document Validation"}),g&&e.jsxs("div",{className:"service-status",children:[e.jsx("span",{className:`status-indicator ${g.status}`}),e.jsx("small",{children:g.validator_available?"Service Available":"Service Unavailable"})]})]}),t.length>0&&e.jsxs("div",{className:"validation-controls",children:[e.jsx("button",{onClick:y,disabled:o,className:"validate-button primary",children:o?e.jsx(s,{size:"small"}):"ðŸ” Validate All Documents"}),1===t.length&&e.jsx("button",{onClick:()=>{return e=t[0],r(null,null,function*(){m(!0),h(null);try{const s=yield n.validateWithRecommendations(e);d(e=>{const a=e.findIndex(e=>e.document_id===s.document_id);if(a>=0){const t=[...e];return t[a]=s,t}return[...e,s]}),x(e)}catch(s){const e=s instanceof Error?s.message:"Validation failed";h(e)}finally{m(!1)}});var e},disabled:o,className:"validate-button secondary",children:o?e.jsx(s,{size:"small"}):"ðŸ” Validate Document"}),e.jsxs("div",{className:"document-count",children:[t.length," document",1!==t.length?"s":""," ready for validation"]})]}),o&&p.total>0&&e.jsxs("div",{className:"validation-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:p.processed/p.total*100+"%"}})}),e.jsxs("div",{className:"progress-text",children:["Validating ",p.processed,"/",p.total," documents..."]})]}),u&&e.jsxs("div",{className:"error-message",children:[e.jsx("strong",{children:"Validation Error:"})," ",u,e.jsx("button",{onClick:()=>h(null),className:"close-error",children:"Ã—"})]}),(()=>{if(0===c.length)return null;const s=c.filter(e=>e.is_valid).length,a=c.reduce((e,s)=>e+s.quality_metrics.overall_score,0)/c.length,t=c.reduce((e,s)=>e+s.quality_metrics.errors,0),l=c.reduce((e,s)=>e+s.quality_metrics.warnings,0);return e.jsxs("div",{className:"validation-summary",children:[e.jsx("h3",{children:"Validation Summary"}),e.jsxs("div",{className:"summary-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsxs("span",{className:"stat-value",children:[s,"/",c.length]}),e.jsx("span",{className:"stat-label",children:"Valid Documents"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsxs("span",{className:"stat-value",children:[(100*a).toFixed(0),"%"]}),e.jsx("span",{className:"stat-label",children:"Avg Quality"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:t}),e.jsx("span",{className:"stat-label",children:"Total Errors"})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-value",children:l}),e.jsx("span",{className:"stat-label",children:"Total Warnings"})]})]})]})})(),e.jsx("div",{className:"validation-results",children:c.map(s=>{return e.jsxs("div",{className:"validation-result",children:[e.jsxs("div",{className:"result-header",children:[e.jsx("h4",{children:s.document_id}),e.jsx("span",{className:"validity-badge "+(s.is_valid?"valid":"invalid"),children:s.is_valid?"âœ“ Valid":"âœ— Invalid"}),e.jsx("span",{className:`quality-badge ${_(s.quality_metrics.overall_score)}`,children:_(s.quality_metrics.overall_score)})]}),(t=s.quality_metrics,e.jsxs("div",{className:"quality-metrics",children:[e.jsxs("div",{className:"metric-item",children:[e.jsx("span",{className:"metric-label",children:"Overall Quality:"}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-fill",style:{width:100*t.overall_score+"%",backgroundColor:b(t.overall_score)}})}),e.jsxs("span",{className:"metric-value",children:[(100*t.overall_score).toFixed(0),"%"]})]}),e.jsxs("div",{className:"metric-item",children:[e.jsx("span",{className:"metric-label",children:"Completeness:"}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-fill",style:{width:100*t.completeness_score+"%",backgroundColor:b(t.completeness_score)}})}),e.jsxs("span",{className:"metric-value",children:[(100*t.completeness_score).toFixed(0),"%"]})]}),e.jsxs("div",{className:"metric-item",children:[e.jsx("span",{className:"metric-label",children:"Format:"}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-fill",style:{width:100*t.format_score+"%",backgroundColor:b(t.format_score)}})}),e.jsxs("span",{className:"metric-value",children:[(100*t.format_score).toFixed(0),"%"]})]}),e.jsxs("div",{className:"metric-item",children:[e.jsx("span",{className:"metric-label",children:"Consistency:"}),e.jsx("div",{className:"metric-bar",children:e.jsx("div",{className:"metric-fill",style:{width:100*t.consistency_score+"%",backgroundColor:b(t.consistency_score)}})}),e.jsxs("span",{className:"metric-value",children:[(100*t.consistency_score).toFixed(0),"%"]})]}),e.jsxs("div",{className:"metric-summary",children:[e.jsxs("span",{children:["Rules: ",t.passed_rules,"/",t.total_rules]}),t.errors>0&&e.jsxs("span",{className:"errors",children:["Errors: ",t.errors]}),t.warnings>0&&e.jsxs("span",{className:"warnings",children:["Warnings: ",t.warnings]})]})]})),e.jsxs("div",{className:"validation-details",children:[e.jsxs("div",{className:"section",children:[e.jsx("h5",{children:"Validation Rules"}),(a=s.validation_rules,e.jsx("div",{className:"validation-rules",children:a.map((s,a)=>e.jsxs("div",{className:`rule-item ${s.level} ${s.passed?"passed":"failed"}`,children:[e.jsxs("div",{className:"rule-header",children:[e.jsx("span",{className:"rule-icon "+(s.passed?"success":"failure"),children:s.passed?"âœ“":"âœ—"}),e.jsx("span",{className:"rule-name",children:s.rule_name}),e.jsx("span",{className:`rule-level ${s.level}`,children:s.level})]}),e.jsx("div",{className:"rule-message",children:s.message}),s.details&&e.jsx("div",{className:"rule-details",children:e.jsx("pre",{children:JSON.stringify(s.details,null,2)})})]},a))}))]}),s.recommendations.length>0&&e.jsxs("div",{className:"section",children:[e.jsx("h5",{children:"Recommendations"}),e.jsx("ul",{className:"recommendations",children:s.recommendations.map((s,a)=>e.jsx("li",{children:s},a))})]}),e.jsx("div",{className:"result-metadata",children:e.jsxs("small",{children:["Document Type: ",s.document_type," | Processing Time: ",s.processing_time_ms.toFixed(0),"ms | Validated: ",new Date(s.validation_timestamp).toLocaleString()]})})]})]},s.document_id);var a,t})}),0===t.length&&!o&&e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"ðŸ“„ Select documents to validate their quality and compliance."}),e.jsx("p",{children:"The validation framework checks:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"URN format compliance with Brazilian standards"}),e.jsx("li",{children:"Metadata completeness and accuracy"}),e.jsx("li",{children:"Document structure and formatting"}),e.jsx("li",{children:"Transport domain relevance (if applicable)"})]})]})]})};export{c as default};
